[2025-12-02 16:42:42] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:42:42.700933Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:42:43] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:43:43] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:43:43.594162Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:43:44] local.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"e771cff7-b9c4-456c-a58e-42de0f7fa8e4","product_id":1,"quantity":10} 
[2025-12-02 16:43:44] local.INFO: Hold DELETED (expired) {"hold_id":"e771cff7-b9c4-456c-a58e-42de0f7fa8e4","product_id":1,"quantity_restored":10,"stock_released":true} 
[2025-12-02 16:43:44] local.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"e771cff7-b9c4-456c-a58e-42de0f7fa8e4"} 
[2025-12-02 16:43:44] local.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.05} 
[2025-12-02 16:44:44] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:44:44.686723Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:44:45] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:45:47] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:45:47.338959Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:45:48] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:46:50] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:46:50.631349Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:46:51] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:47:56] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:47:56.109274Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:47:56] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:48:58] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:48:58.002992Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:48:58] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:50:00] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:50:00.051940Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:50:00] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:50:38] local.INFO: Order creation started {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc"} 
[2025-12-02 16:50:38] local.INFO: Validating hold {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","attempt":1} 
[2025-12-02 16:50:38] local.DEBUG: Hold data retrieved from Redis {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","hold_data":{"product_id":"1","qty":"10","created_at":"2025-12-02T16:50:22.298992Z","expires_at":"2025-12-02T16:52:22.300136Z","expires_at_timestamp":"1764694342","hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","status":"active","version":"6"}} 
[2025-12-02 16:50:38] local.INFO: Hold validated successfully {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","product_id":1,"quantity":10,"status":"active"} 
[2025-12-02 16:50:38] local.INFO: Hold validation successful {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","product_id":1,"quantity":10} 
[2025-12-02 16:50:38] local.INFO: Creating order in database {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc"} 
[2025-12-02 16:50:38] local.INFO: Order saved to database {"order_id":4,"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc"} 
[2025-12-02 16:50:39] local.INFO: Order created successfully {"order_id":4,"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","product_id":1,"quantity":10} 
[2025-12-02 16:51:01] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:51:01.040197Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:51:01] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:52:02] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:52:02.449934Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:52:03] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:53:12] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:53:12.176828Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:53:12] local.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","product_id":1,"quantity":10} 
[2025-12-02 16:53:12] local.INFO: Hold DELETED (expired) {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc","product_id":1,"quantity_restored":10,"stock_released":true} 
[2025-12-02 16:53:12] local.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"9f0188c5-2478-4245-b546-eede8df0aebc"} 
[2025-12-02 16:53:12] local.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.05} 
[2025-12-02 16:54:13] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:54:13.505821Z","holds_total":1,"available_stock_1":"10","reserved_stock_1":"0"} 
[2025-12-02 16:54:13] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:54:46] local.INFO: Order creation started {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf"} 
[2025-12-02 16:54:46] local.INFO: Validating hold {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","attempt":1} 
[2025-12-02 16:54:46] local.DEBUG: Hold data retrieved from Redis {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","hold_data":{"product_id":"1","qty":"10","created_at":"2025-12-02T16:54:29.932998Z","expires_at":"2025-12-02T16:56:29.933440Z","expires_at_timestamp":"1764694589","hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","status":"active","version":"8"}} 
[2025-12-02 16:54:46] local.INFO: Hold validated successfully {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","product_id":1,"quantity":10,"status":"active"} 
[2025-12-02 16:54:46] local.INFO: Hold validation successful {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","product_id":1,"quantity":10} 
[2025-12-02 16:54:46] local.INFO: Creating order in database {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf"} 
[2025-12-02 16:54:46] local.INFO: Order saved to database {"order_id":5,"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf"} 
[2025-12-02 16:54:46] local.INFO: Order created successfully {"order_id":5,"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","product_id":1,"quantity":10} 
[2025-12-02 16:55:09] local.INFO: Payment webhook received {"idempotency_key":"123","order_id":5,"status":"success"} 
[2025-12-02 16:55:14] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:55:14.333285Z","holds_total":2,"available_stock_1":"0","reserved_stock_1":"10"} 
[2025-12-02 16:55:14] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:55:19] local.INFO: Payment webhook received {"idempotency_key":"1456","order_id":5,"status":"success"} 
[2025-12-02 16:55:19] local.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"31a7a893-f315-4f0e-a6fe-62df41840adf","order_id":5,"product_id":1,"quantity":10} 
[2025-12-02 16:55:19] local.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":10,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 16:56:16] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:56:16.143879Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 16:56:16] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:57:18] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:57:18.832012Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 16:57:19] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:58:19] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:58:19.733873Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 16:58:20] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 16:59:21] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T16:59:21.265546Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 16:59:21] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:00:22] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:00:22.140066Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:00:22] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:01:23] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:01:23.229262Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:01:23] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:02:24] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:02:24.454839Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:02:25] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:03:25] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:03:25.735728Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:03:26] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:04:26] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:04:26.869767Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:04:27] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:05:28] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:05:28.837636Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:05:29] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.02} 
[2025-12-02 17:06:29] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:06:29.945621Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:06:30] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:07:30] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:07:30.829784Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:07:31] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:08:31] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:08:31.897757Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:08:32] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:09:32] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:09:32.937644Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:09:33] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:10:34] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:10:34.025913Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:10:34] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:11:35] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:11:35.003383Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:11:35] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:12:36] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:12:36.092947Z","holds_total":1,"available_stock_1":"0","reserved_stock_1":"0"} 
[2025-12-02 17:12:36] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:13:37] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:13:37.213299Z","holds_total":5,"available_stock_1":"0","reserved_stock_1":"5"} 
[2025-12-02 17:13:37] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:14:05] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"test-expired-hold-1764695645","product_id":1,"quantity":2} 
[2025-12-02 17:14:05] testing.INFO: Hold DELETED (expired) {"hold_id":"test-expired-hold-1764695645","product_id":1,"quantity_restored":2,"stock_released":true} 
[2025-12-02 17:14:05] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"test-expired-hold-1764695645"} 
[2025-12-02 17:14:05] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.02} 
[2025-12-02 17:14:07] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:14:09] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:14:13] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"poc-test-692f1e64bef75","product_id":777,"quantity":1} 
[2025-12-02 17:14:13] testing.INFO: Hold DELETED (expired) {"hold_id":"poc-test-692f1e64bef75","product_id":777,"quantity_restored":1,"stock_released":true} 
[2025-12-02 17:14:13] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"poc-test-692f1e64bef75"} 
[2025-12-02 17:14:13] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:14:13] testing.DEBUG: Stock oversell logic test took: 0.01ms  
[2025-12-02 17:14:20] testing.INFO: Cleared all test data  
[2025-12-02 17:14:20] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:14:20] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 17:14:20] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 17:14:20] testing.INFO: Hold created {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","product_id":1} 
[2025-12-02 17:14:20] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 17:14:20] testing.INFO: Order creation started {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad"} 
[2025-12-02 17:14:20] testing.INFO: Validating hold {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","attempt":1} 
[2025-12-02 17:14:20] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:20.787443Z","expires_at":"2025-12-02T17:16:20.787595Z","expires_at_timestamp":"1764695780","hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","status":"active","version":"2"}} 
[2025-12-02 17:14:20] testing.INFO: Hold validated successfully {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:20] testing.INFO: Hold validation successful {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","product_id":1,"quantity":2} 
[2025-12-02 17:14:20] testing.INFO: Creating order in database {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad"} 
[2025-12-02 17:14:20] testing.INFO: Order saved to database {"order_id":1,"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad"} 
[2025-12-02 17:14:20] testing.INFO: Order created successfully {"order_id":1,"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","product_id":1,"quantity":2} 
[2025-12-02 17:14:20] testing.INFO: Order created {"order_id":1,"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad"} 
[2025-12-02 17:14:20] testing.INFO: Payment webhook received {"idempotency_key":"test_key_TrsRler8tA","order_id":1,"status":"success"} 
[2025-12-02 17:14:20] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"c4f3ad23-3835-4e42-a610-1c8d886e73ad","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:14:20] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:14:24] testing.INFO: Cleared all test data  
[2025-12-02 17:14:30] testing.INFO: Cleared all test data  
[2025-12-02 17:14:31] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:14:31] testing.INFO: === Debug hold creation ===  
[2025-12-02 17:14:31] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 17:14:31] testing.INFO: Hold created successfully {"hold_id":"8578f044-6416-4f8a-bf64-ca5ce082d7c5","expires_at":"2025-12-02T17:16:31.484963Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 17:14:34] testing.INFO: Cleared all test data  
[2025-12-02 17:14:38] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:14:38.367039Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:14:38] testing.INFO: Cleared all test data  
[2025-12-02 17:14:38] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:14:38] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 17:14:38] testing.INFO: Order creation started {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01"} 
[2025-12-02 17:14:38] testing.INFO: Validating hold {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","attempt":1} 
[2025-12-02 17:14:38] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:14:38.917224Z","expires_at":"2025-12-02T17:16:38.917399Z","expires_at_timestamp":"1764695798","hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","status":"active","version":"2"}} 
[2025-12-02 17:14:38] testing.INFO: Hold validated successfully {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:14:38] testing.INFO: Hold validation successful {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","product_id":1,"quantity":1} 
[2025-12-02 17:14:38] testing.INFO: Creating order in database {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01"} 
[2025-12-02 17:14:38] testing.INFO: Order saved to database {"order_id":1,"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01"} 
[2025-12-02 17:14:38] testing.INFO: Order created successfully {"order_id":1,"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","product_id":1,"quantity":1} 
[2025-12-02 17:14:38] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_hDPFBOJAmz","order_id":1,"status":"success"} 
[2025-12-02 17:14:39] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"2b52b3a8-e63c-4ff8-b832-ed9978742d01","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:14:39] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:14:39] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_hDPFBOJAmz","order_id":1,"status":"success"} 
[2025-12-02 17:14:39] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 17:14:39] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_hDPFBOJAmz"} 
[2025-12-02 17:14:39] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:14:45] testing.INFO: Cleared all test data  
[2025-12-02 17:14:48] testing.INFO: Cleared all test data  
[2025-12-02 17:14:48] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:14:48] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 17:14:48] testing.INFO: Order creation started {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e"} 
[2025-12-02 17:14:48] testing.INFO: Validating hold {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","attempt":1} 
[2025-12-02 17:14:48] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T17:14:48.879993Z","expires_at":"2025-12-02T17:16:48.880122Z","expires_at_timestamp":"1764695808","hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","status":"active","version":"2"}} 
[2025-12-02 17:14:48] testing.INFO: Hold validated successfully {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 17:14:48] testing.INFO: Hold validation successful {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","product_id":1,"quantity":3} 
[2025-12-02 17:14:48] testing.INFO: Creating order in database {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e"} 
[2025-12-02 17:14:48] testing.INFO: Order saved to database {"order_id":1,"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e"} 
[2025-12-02 17:14:48] testing.INFO: Order created successfully {"order_id":1,"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","product_id":1,"quantity":3} 
[2025-12-02 17:14:48] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_bzL5jQrOTI","order_id":1,"status":"failure"} 
[2025-12-02 17:14:48] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"39aa8fbf-48ad-4ba3-aa88-029a5d54f37e","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 17:14:48] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:14:52] testing.INFO: Cleared all test data  
[2025-12-02 17:14:58] testing.INFO: Cleared all test data  
[2025-12-02 17:14:58] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:14:58] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 17:14:58] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 17:14:58] testing.DEBUG: Hold created {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 17:14:58] testing.DEBUG: Hold created {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 17:14:58] testing.DEBUG: Hold created {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 17:14:58] testing.DEBUG: Hold created {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 17:14:58] testing.DEBUG: Hold created {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 17:14:58] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 17:14:58] testing.INFO: Order creation started {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43"} 
[2025-12-02 17:14:58] testing.INFO: Validating hold {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","attempt":1} 
[2025-12-02 17:14:58] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:58.642076Z","expires_at":"2025-12-02T17:16:58.642244Z","expires_at_timestamp":"1764695818","hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","status":"active","version":"2"}} 
[2025-12-02 17:14:58] testing.INFO: Hold validated successfully {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:58] testing.INFO: Hold validation successful {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","product_id":1,"quantity":2} 
[2025-12-02 17:14:58] testing.INFO: Creating order in database {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43"} 
[2025-12-02 17:14:58] testing.INFO: Order saved to database {"order_id":1,"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43"} 
[2025-12-02 17:14:58] testing.INFO: Order created successfully {"order_id":1,"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","product_id":1,"quantity":2} 
[2025-12-02 17:14:58] testing.DEBUG: Order created {"order_id":1,"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","quantity":2} 
[2025-12-02 17:14:58] testing.INFO: Order creation started {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045"} 
[2025-12-02 17:14:58] testing.INFO: Validating hold {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","attempt":1} 
[2025-12-02 17:14:58] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:58.645095Z","expires_at":"2025-12-02T17:16:58.645217Z","expires_at_timestamp":"1764695818","hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","status":"active","version":"3"}} 
[2025-12-02 17:14:58] testing.INFO: Hold validated successfully {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:58] testing.INFO: Hold validation successful {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","product_id":1,"quantity":2} 
[2025-12-02 17:14:58] testing.INFO: Creating order in database {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045"} 
[2025-12-02 17:14:58] testing.INFO: Order saved to database {"order_id":2,"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045"} 
[2025-12-02 17:14:59] testing.INFO: Order created successfully {"order_id":2,"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.DEBUG: Order created {"order_id":2,"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Order creation started {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c"} 
[2025-12-02 17:14:59] testing.INFO: Validating hold {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","attempt":1} 
[2025-12-02 17:14:59] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:58.647893Z","expires_at":"2025-12-02T17:16:58.648008Z","expires_at_timestamp":"1764695818","hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","status":"active","version":"4"}} 
[2025-12-02 17:14:59] testing.INFO: Hold validated successfully {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:59] testing.INFO: Hold validation successful {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Creating order in database {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c"} 
[2025-12-02 17:14:59] testing.INFO: Order saved to database {"order_id":3,"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c"} 
[2025-12-02 17:14:59] testing.INFO: Order created successfully {"order_id":3,"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.DEBUG: Order created {"order_id":3,"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Order creation started {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1"} 
[2025-12-02 17:14:59] testing.INFO: Validating hold {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","attempt":1} 
[2025-12-02 17:14:59] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:58.650278Z","expires_at":"2025-12-02T17:16:58.650457Z","expires_at_timestamp":"1764695818","hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","status":"active","version":"5"}} 
[2025-12-02 17:14:59] testing.INFO: Hold validated successfully {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:59] testing.INFO: Hold validation successful {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Creating order in database {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1"} 
[2025-12-02 17:14:59] testing.INFO: Order saved to database {"order_id":4,"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1"} 
[2025-12-02 17:14:59] testing.INFO: Order created successfully {"order_id":4,"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.DEBUG: Order created {"order_id":4,"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Order creation started {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57"} 
[2025-12-02 17:14:59] testing.INFO: Validating hold {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","attempt":1} 
[2025-12-02 17:14:59] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:14:58.653320Z","expires_at":"2025-12-02T17:16:58.653457Z","expires_at_timestamp":"1764695818","hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","status":"active","version":"6"}} 
[2025-12-02 17:14:59] testing.INFO: Hold validated successfully {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:14:59] testing.INFO: Hold validation successful {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Creating order in database {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57"} 
[2025-12-02 17:14:59] testing.INFO: Order saved to database {"order_id":5,"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57"} 
[2025-12-02 17:14:59] testing.INFO: Order created successfully {"order_id":5,"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.DEBUG: Order created {"order_id":5,"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 17:14:59] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_9A5ED65ZCP","order_id":1,"status":"success"} 
[2025-12-02 17:14:59] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:14:59] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 17:14:59] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_2AOigBYjE7","order_id":2,"status":"success"} 
[2025-12-02 17:14:59] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:14:59] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 17:14:59] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_q1HmcMvhyB","order_id":3,"status":"success"} 
[2025-12-02 17:14:59] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:14:59] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 17:14:59] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_3d9UqrEQ2u","order_id":4,"status":"success"} 
[2025-12-02 17:14:59] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 17:14:59] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:00] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 17:15:00] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_s5eZrVeGNT","order_id":5,"status":"success"} 
[2025-12-02 17:15:00] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 17:15:00] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:00] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 17:15:00] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 17:15:00] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"4a553236-56e0-4909-9a05-5259dc876e43"} 
[2025-12-02 17:15:00] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045"} 
[2025-12-02 17:15:00] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c"} 
[2025-12-02 17:15:00] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1"} 
[2025-12-02 17:15:00] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57"} 
[2025-12-02 17:15:00] testing.DEBUG: Hold state {"hold_id":"4a553236-56e0-4909-9a05-5259dc876e43","status":"unknown","quantity":2} 
[2025-12-02 17:15:00] testing.DEBUG: Hold state {"hold_id":"ea4a2a0c-99d9-412a-afe4-d7eb6466a045","status":"unknown","quantity":2} 
[2025-12-02 17:15:00] testing.DEBUG: Hold state {"hold_id":"260c84f1-65a9-42de-8bf6-43f922cecb7c","status":"unknown","quantity":2} 
[2025-12-02 17:15:00] testing.DEBUG: Hold state {"hold_id":"9aff0d51-3f13-4e88-a5eb-2c8e9fbe4dc1","status":"unknown","quantity":2} 
[2025-12-02 17:15:00] testing.DEBUG: Hold state {"hold_id":"23ac6f00-1080-47bf-968c-b3b82778ad57","status":"unknown","quantity":2} 
[2025-12-02 17:15:03] testing.INFO: Cleared all test data  
[2025-12-02 17:15:07] testing.INFO: Cleared all test data  
[2025-12-02 17:15:07] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:15:07] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 17:15:07] testing.INFO: Order creation started {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b"} 
[2025-12-02 17:15:07] testing.INFO: Validating hold {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","attempt":1} 
[2025-12-02 17:15:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:07.806962Z","expires_at":"2025-12-02T17:17:07.807117Z","expires_at_timestamp":"1764695827","hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","status":"active","version":"2"}} 
[2025-12-02 17:15:07] testing.INFO: Hold validated successfully {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:07] testing.INFO: Hold validation successful {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","product_id":1,"quantity":1} 
[2025-12-02 17:15:07] testing.INFO: Creating order in database {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b"} 
[2025-12-02 17:15:07] testing.INFO: Order saved to database {"order_id":1,"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b"} 
[2025-12-02 17:15:07] testing.INFO: Order created successfully {"order_id":1,"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","product_id":1,"quantity":1} 
[2025-12-02 17:15:07] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_XYo17fcgt0","order_id":999999,"status":"success"} 
[2025-12-02 17:15:07] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_XYo17fcgt0","order_id":999999,"status":"success"} 
[2025-12-02 17:15:07] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_XYo17fcgt0","order_id":1,"status":"success"} 
[2025-12-02 17:15:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"0e51ee3c-0800-4487-a125-56fa4f4e332b","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:15:07] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:07] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 17:15:13] testing.INFO: Cleared all test data  
[2025-12-02 17:15:17] testing.INFO: Cleared all test data  
[2025-12-02 17:15:17] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:15:17] testing.INFO: === Starting data integrity test ===  
[2025-12-02 17:15:17] testing.INFO: Order creation started {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b"} 
[2025-12-02 17:15:17] testing.INFO: Validating hold {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","attempt":1} 
[2025-12-02 17:15:17] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:17.532693Z","expires_at":"2025-12-02T17:17:17.532836Z","expires_at_timestamp":"1764695837","hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","status":"active","version":"2"}} 
[2025-12-02 17:15:17] testing.INFO: Hold validated successfully {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:17] testing.INFO: Hold validation successful {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Creating order in database {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b"} 
[2025-12-02 17:15:17] testing.INFO: Order saved to database {"order_id":1,"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b"} 
[2025-12-02 17:15:17] testing.INFO: Order created successfully {"order_id":1,"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Payment webhook received {"idempotency_key":"integrity_t9jw31vmHC","order_id":1,"status":"success"} 
[2025-12-02 17:15:17] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"462d758a-875e-4f69-95a7-4b3ef14c144b","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:17] testing.INFO: Order creation started {"hold_id":"52025704-9665-4619-b453-40ac71c000ed"} 
[2025-12-02 17:15:17] testing.INFO: Validating hold {"hold_id":"52025704-9665-4619-b453-40ac71c000ed","attempt":1} 
[2025-12-02 17:15:17] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"52025704-9665-4619-b453-40ac71c000ed","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:17.752000Z","expires_at":"2025-12-02T17:17:17.752123Z","expires_at_timestamp":"1764695837","hold_id":"52025704-9665-4619-b453-40ac71c000ed","status":"active","version":"4"}} 
[2025-12-02 17:15:17] testing.INFO: Hold validated successfully {"hold_id":"52025704-9665-4619-b453-40ac71c000ed","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:17] testing.INFO: Hold validation successful {"hold_id":"52025704-9665-4619-b453-40ac71c000ed","product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Creating order in database {"hold_id":"52025704-9665-4619-b453-40ac71c000ed"} 
[2025-12-02 17:15:17] testing.INFO: Order saved to database {"order_id":2,"hold_id":"52025704-9665-4619-b453-40ac71c000ed"} 
[2025-12-02 17:15:17] testing.INFO: Order created successfully {"order_id":2,"hold_id":"52025704-9665-4619-b453-40ac71c000ed","product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Payment webhook received {"idempotency_key":"integrity_NPKPQhZVOm","order_id":2,"status":"failure"} 
[2025-12-02 17:15:17] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"52025704-9665-4619-b453-40ac71c000ed","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:15:17] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:15:17] testing.INFO: Order creation started {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6"} 
[2025-12-02 17:15:17] testing.INFO: Validating hold {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","attempt":1} 
[2025-12-02 17:15:17] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:17.961852Z","expires_at":"2025-12-02T17:17:17.961982Z","expires_at_timestamp":"1764695837","hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","status":"active","version":"6"}} 
[2025-12-02 17:15:17] testing.INFO: Hold validated successfully {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:17] testing.INFO: Hold validation successful {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","product_id":1,"quantity":1} 
[2025-12-02 17:15:17] testing.INFO: Creating order in database {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6"} 
[2025-12-02 17:15:17] testing.INFO: Order saved to database {"order_id":3,"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6"} 
[2025-12-02 17:15:18] testing.INFO: Order created successfully {"order_id":3,"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Payment webhook received {"idempotency_key":"integrity_O20qcU8Txt","order_id":3,"status":"success"} 
[2025-12-02 17:15:18] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"dcc02b76-9f9f-4f48-9959-d19143aeedc6","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:18] testing.INFO: Order creation started {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532"} 
[2025-12-02 17:15:18] testing.INFO: Validating hold {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","attempt":1} 
[2025-12-02 17:15:18] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:18.259029Z","expires_at":"2025-12-02T17:17:18.259154Z","expires_at_timestamp":"1764695838","hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","status":"active","version":"8"}} 
[2025-12-02 17:15:18] testing.INFO: Hold validated successfully {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:18] testing.INFO: Hold validation successful {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Creating order in database {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532"} 
[2025-12-02 17:15:18] testing.INFO: Order saved to database {"order_id":4,"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532"} 
[2025-12-02 17:15:18] testing.INFO: Order created successfully {"order_id":4,"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Payment webhook received {"idempotency_key":"integrity_iXdBk3kgi7","order_id":4,"status":"failure"} 
[2025-12-02 17:15:18] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"23ddfe4a-af16-47c6-9012-e7d89b267532","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:15:18] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:15:18] testing.INFO: Order creation started {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669"} 
[2025-12-02 17:15:18] testing.INFO: Validating hold {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","attempt":1} 
[2025-12-02 17:15:18] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:18.599578Z","expires_at":"2025-12-02T17:17:18.599761Z","expires_at_timestamp":"1764695838","hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","status":"active","version":"10"}} 
[2025-12-02 17:15:18] testing.INFO: Hold validated successfully {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:18] testing.INFO: Hold validation successful {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Creating order in database {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669"} 
[2025-12-02 17:15:18] testing.INFO: Order saved to database {"order_id":5,"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669"} 
[2025-12-02 17:15:18] testing.INFO: Order created successfully {"order_id":5,"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Payment webhook received {"idempotency_key":"integrity_bdwErPogGm","order_id":5,"status":"success"} 
[2025-12-02 17:15:18] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"6b77f02c-7c96-4347-b1af-1ae343b93669","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 17:15:18] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:19] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 17:15:25] testing.INFO: Cleared all test data  
[2025-12-02 17:15:29] testing.INFO: Cleared all test data  
[2025-12-02 17:15:29] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:15:29] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 17:15:29] testing.INFO: Order creation started {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e"} 
[2025-12-02 17:15:29] testing.INFO: Validating hold {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","attempt":1} 
[2025-12-02 17:15:29] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:15:29.497865Z","expires_at":"2025-12-02T17:17:29.498031Z","expires_at_timestamp":"1764695849","hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","status":"active","version":"2"}} 
[2025-12-02 17:15:29] testing.INFO: Hold validated successfully {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:15:29] testing.INFO: Hold validation successful {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","product_id":1,"quantity":1} 
[2025-12-02 17:15:29] testing.INFO: Creating order in database {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e"} 
[2025-12-02 17:15:29] testing.INFO: Order saved to database {"order_id":1,"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e"} 
[2025-12-02 17:15:29] testing.INFO: Order created successfully {"order_id":1,"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","product_id":1,"quantity":1} 
[2025-12-02 17:15:29] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_fxLja8jwFz","order_id":1,"status":"success"} 
[2025-12-02 17:15:29] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"a02ae83d-bba3-4b7c-a59c-451a3c3bff5e","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:15:29] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:15:33] testing.INFO: Cleared all test data  
[2025-12-02 17:15:39] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:15:39.445104Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:15:40] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:16:40] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:16:40.518993Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:16:41] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:17:41] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:17:41.743887Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:17:42] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:18:42] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:18:42.909600Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:18:43] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:19:43] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:19:43.802398Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:19:44] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:20:44] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:20:44.901331Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:20:45] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:21:46] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:21:45.994373Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:21:46] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:22:47] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:22:47.069800Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:22:47] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:23:48] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:23:48.192455Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:23:48] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:24:49] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:24:49.067550Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:24:49] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:25:50] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:25:50.106280Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:25:50] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:26:51] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:26:50.997518Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:26:51] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:27:52] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:27:52.124434Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:27:52] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:28:53] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:28:53.146540Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:28:53] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:29:54] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:29:53.993257Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:29:54] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:30:55] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:30:55.113688Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:30:55] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:31:56] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:31:56.025832Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:31:56] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:32:56] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:32:56.914965Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:32:57] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:33:57] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:33:57.793301Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:33:58] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:34:58] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:34:58.849715Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:34:59] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:35:59] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:35:59.718884Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:36:00] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:37:00] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:37:00.574224Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:37:01] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:38:01] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:38:01.607001Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:38:02] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:38:42] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"test-expired-hold-1764697122","product_id":1,"quantity":2} 
[2025-12-02 17:38:42] testing.INFO: Hold DELETED (expired) {"hold_id":"test-expired-hold-1764697122","product_id":1,"quantity_restored":2,"stock_released":true} 
[2025-12-02 17:38:42] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"test-expired-hold-1764697122"} 
[2025-12-02 17:38:42] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.03} 
[2025-12-02 17:38:43] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:38:46] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:38:48] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"poc-test-692f2427ed6a8","product_id":777,"quantity":1} 
[2025-12-02 17:38:48] testing.INFO: Hold DELETED (expired) {"hold_id":"poc-test-692f2427ed6a8","product_id":777,"quantity_restored":1,"stock_released":true} 
[2025-12-02 17:38:48] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"poc-test-692f2427ed6a8"} 
[2025-12-02 17:38:48] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:38:48] testing.DEBUG: Stock oversell logic test took: 0.01ms  
[2025-12-02 17:38:54] testing.INFO: Cleared all test data  
[2025-12-02 17:38:54] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:38:54] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 17:38:54] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 17:38:54] testing.INFO: Hold created {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","product_id":1} 
[2025-12-02 17:38:54] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 17:38:54] testing.INFO: Order creation started {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b"} 
[2025-12-02 17:38:54] testing.INFO: Validating hold {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","attempt":1} 
[2025-12-02 17:38:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:38:54.853441Z","expires_at":"2025-12-02T17:40:54.853606Z","expires_at_timestamp":"1764697254","hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","status":"active","version":"2"}} 
[2025-12-02 17:38:54] testing.INFO: Hold validated successfully {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:38:54] testing.INFO: Hold validation successful {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","product_id":1,"quantity":2} 
[2025-12-02 17:38:54] testing.INFO: Creating order in database {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b"} 
[2025-12-02 17:38:54] testing.INFO: Order saved to database {"order_id":1,"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b"} 
[2025-12-02 17:38:55] testing.INFO: Order created successfully {"order_id":1,"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","product_id":1,"quantity":2} 
[2025-12-02 17:38:55] testing.INFO: Order created {"order_id":1,"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b"} 
[2025-12-02 17:38:55] testing.INFO: Payment webhook received {"idempotency_key":"test_key_r1FW1wYTky","order_id":1,"status":"success"} 
[2025-12-02 17:38:55] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"6e2100c2-a15b-480b-864c-235e27bed71b","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:38:55] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:38:58] testing.INFO: Cleared all test data  
[2025-12-02 17:39:01] testing.INFO: Cleared all test data  
[2025-12-02 17:39:01] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:01] testing.INFO: === Debug hold creation ===  
[2025-12-02 17:39:01] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 17:39:01] testing.INFO: Hold created successfully {"hold_id":"a549b8b2-06ce-4ff0-869b-7afafbe0aec5","expires_at":"2025-12-02T17:41:01.674921Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 17:39:02] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:39:02.455707Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:39:02] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:39:09] testing.INFO: Cleared all test data  
[2025-12-02 17:39:11] testing.INFO: Cleared all test data  
[2025-12-02 17:39:11] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:12] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 17:39:12] testing.INFO: Order creation started {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263"} 
[2025-12-02 17:39:12] testing.INFO: Validating hold {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","attempt":1} 
[2025-12-02 17:39:12] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:12.074632Z","expires_at":"2025-12-02T17:41:12.074790Z","expires_at_timestamp":"1764697272","hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","status":"active","version":"2"}} 
[2025-12-02 17:39:12] testing.INFO: Hold validated successfully {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:12] testing.INFO: Hold validation successful {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","product_id":1,"quantity":1} 
[2025-12-02 17:39:12] testing.INFO: Creating order in database {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263"} 
[2025-12-02 17:39:12] testing.INFO: Order saved to database {"order_id":1,"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263"} 
[2025-12-02 17:39:12] testing.INFO: Order created successfully {"order_id":1,"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","product_id":1,"quantity":1} 
[2025-12-02 17:39:12] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_BYHpLSMvSs","order_id":1,"status":"success"} 
[2025-12-02 17:39:12] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"4f8caa84-10ec-4491-affd-f3ae2d9f1263","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:39:12] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:12] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_BYHpLSMvSs","order_id":1,"status":"success"} 
[2025-12-02 17:39:12] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 17:39:12] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_BYHpLSMvSs"} 
[2025-12-02 17:39:15] testing.INFO: Cleared all test data  
[2025-12-02 17:39:20] testing.INFO: Cleared all test data  
[2025-12-02 17:39:20] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:21] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 17:39:21] testing.INFO: Order creation started {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342"} 
[2025-12-02 17:39:21] testing.INFO: Validating hold {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","attempt":1} 
[2025-12-02 17:39:21] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T17:39:21.032516Z","expires_at":"2025-12-02T17:41:21.032632Z","expires_at_timestamp":"1764697281","hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","status":"active","version":"2"}} 
[2025-12-02 17:39:21] testing.INFO: Hold validated successfully {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 17:39:21] testing.INFO: Hold validation successful {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","product_id":1,"quantity":3} 
[2025-12-02 17:39:21] testing.INFO: Creating order in database {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342"} 
[2025-12-02 17:39:21] testing.INFO: Order saved to database {"order_id":1,"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342"} 
[2025-12-02 17:39:21] testing.INFO: Order created successfully {"order_id":1,"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","product_id":1,"quantity":3} 
[2025-12-02 17:39:21] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_sGrICeTpZT","order_id":1,"status":"failure"} 
[2025-12-02 17:39:21] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"62bf0d07-3ce9-46e5-b7a6-2542bec30342","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 17:39:21] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:39:21] testing.INFO: Failed payment flow test passed {"order_id":1,"stock_restored":true} 
[2025-12-02 17:39:24] testing.INFO: Cleared all test data  
[2025-12-02 17:39:28] testing.INFO: Cleared all test data  
[2025-12-02 17:39:28] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:28] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 17:39:28] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 17:39:28] testing.DEBUG: Hold created {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 17:39:28] testing.DEBUG: Hold created {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 17:39:28] testing.DEBUG: Hold created {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 17:39:28] testing.DEBUG: Hold created {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 17:39:28] testing.DEBUG: Hold created {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 17:39:28] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 17:39:28] testing.INFO: Order creation started {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090"} 
[2025-12-02 17:39:28] testing.INFO: Validating hold {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","attempt":1} 
[2025-12-02 17:39:28] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:39:28.786505Z","expires_at":"2025-12-02T17:41:28.786627Z","expires_at_timestamp":"1764697288","hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","status":"active","version":"2"}} 
[2025-12-02 17:39:28] testing.INFO: Hold validated successfully {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:39:28] testing.INFO: Hold validation successful {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","product_id":1,"quantity":2} 
[2025-12-02 17:39:28] testing.INFO: Creating order in database {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090"} 
[2025-12-02 17:39:28] testing.INFO: Order saved to database {"order_id":1,"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090"} 
[2025-12-02 17:39:28] testing.INFO: Order created successfully {"order_id":1,"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","product_id":1,"quantity":2} 
[2025-12-02 17:39:28] testing.DEBUG: Order created {"order_id":1,"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","quantity":2} 
[2025-12-02 17:39:28] testing.INFO: Order creation started {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92"} 
[2025-12-02 17:39:28] testing.INFO: Validating hold {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","attempt":1} 
[2025-12-02 17:39:28] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:39:28.788951Z","expires_at":"2025-12-02T17:41:28.789048Z","expires_at_timestamp":"1764697288","hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","status":"active","version":"3"}} 
[2025-12-02 17:39:28] testing.INFO: Hold validated successfully {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:39:28] testing.INFO: Hold validation successful {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","product_id":1,"quantity":2} 
[2025-12-02 17:39:28] testing.INFO: Creating order in database {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92"} 
[2025-12-02 17:39:28] testing.INFO: Order saved to database {"order_id":2,"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92"} 
[2025-12-02 17:39:29] testing.INFO: Order created successfully {"order_id":2,"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.DEBUG: Order created {"order_id":2,"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Order creation started {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378"} 
[2025-12-02 17:39:29] testing.INFO: Validating hold {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","attempt":1} 
[2025-12-02 17:39:29] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:39:28.791704Z","expires_at":"2025-12-02T17:41:28.791813Z","expires_at_timestamp":"1764697288","hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","status":"active","version":"4"}} 
[2025-12-02 17:39:29] testing.INFO: Hold validated successfully {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:39:29] testing.INFO: Hold validation successful {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Creating order in database {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378"} 
[2025-12-02 17:39:29] testing.INFO: Order saved to database {"order_id":3,"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378"} 
[2025-12-02 17:39:29] testing.INFO: Order created successfully {"order_id":3,"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.DEBUG: Order created {"order_id":3,"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Order creation started {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86"} 
[2025-12-02 17:39:29] testing.INFO: Validating hold {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","attempt":1} 
[2025-12-02 17:39:29] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:39:28.794179Z","expires_at":"2025-12-02T17:41:28.794269Z","expires_at_timestamp":"1764697288","hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","status":"active","version":"5"}} 
[2025-12-02 17:39:29] testing.INFO: Hold validated successfully {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:39:29] testing.INFO: Hold validation successful {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Creating order in database {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86"} 
[2025-12-02 17:39:29] testing.INFO: Order saved to database {"order_id":4,"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86"} 
[2025-12-02 17:39:29] testing.INFO: Order created successfully {"order_id":4,"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.DEBUG: Order created {"order_id":4,"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Order creation started {"hold_id":"435a4955-b207-452e-a110-28f17df635f1"} 
[2025-12-02 17:39:29] testing.INFO: Validating hold {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","attempt":1} 
[2025-12-02 17:39:29] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:39:28.796530Z","expires_at":"2025-12-02T17:41:28.796647Z","expires_at_timestamp":"1764697288","hold_id":"435a4955-b207-452e-a110-28f17df635f1","status":"active","version":"6"}} 
[2025-12-02 17:39:29] testing.INFO: Hold validated successfully {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:39:29] testing.INFO: Hold validation successful {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Creating order in database {"hold_id":"435a4955-b207-452e-a110-28f17df635f1"} 
[2025-12-02 17:39:29] testing.INFO: Order saved to database {"order_id":5,"hold_id":"435a4955-b207-452e-a110-28f17df635f1"} 
[2025-12-02 17:39:29] testing.INFO: Order created successfully {"order_id":5,"hold_id":"435a4955-b207-452e-a110-28f17df635f1","product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.DEBUG: Order created {"order_id":5,"hold_id":"435a4955-b207-452e-a110-28f17df635f1","quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 17:39:29] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_Gph4i9Icmw","order_id":1,"status":"success"} 
[2025-12-02 17:39:29] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:29] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 17:39:29] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_gy9GVrw37C","order_id":2,"status":"success"} 
[2025-12-02 17:39:29] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 17:39:29] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:30] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 17:39:30] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_FqEgEZmtJh","order_id":3,"status":"success"} 
[2025-12-02 17:39:30] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 17:39:30] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:30] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 17:39:30] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_One2e5BTnn","order_id":4,"status":"success"} 
[2025-12-02 17:39:30] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 17:39:30] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:30] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 17:39:30] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_nUhwfVHh9z","order_id":5,"status":"success"} 
[2025-12-02 17:39:31] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 17:39:31] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:31] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 17:39:31] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 17:39:31] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090"} 
[2025-12-02 17:39:31] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92"} 
[2025-12-02 17:39:31] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"e524eeeb-9ea8-422f-bf87-576912090378"} 
[2025-12-02 17:39:31] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86"} 
[2025-12-02 17:39:31] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"435a4955-b207-452e-a110-28f17df635f1"} 
[2025-12-02 17:39:31] testing.DEBUG: Hold state {"hold_id":"5a875632-4e57-4c6c-ac7f-a62635fe5090","status":"unknown","quantity":2} 
[2025-12-02 17:39:31] testing.DEBUG: Hold state {"hold_id":"865e9e73-0d37-4194-8890-a097ec29ce92","status":"unknown","quantity":2} 
[2025-12-02 17:39:31] testing.DEBUG: Hold state {"hold_id":"e524eeeb-9ea8-422f-bf87-576912090378","status":"unknown","quantity":2} 
[2025-12-02 17:39:31] testing.DEBUG: Hold state {"hold_id":"bc21ad4c-6c64-4565-a106-c7d019392c86","status":"unknown","quantity":2} 
[2025-12-02 17:39:31] testing.DEBUG: Hold state {"hold_id":"435a4955-b207-452e-a110-28f17df635f1","status":"unknown","quantity":2} 
[2025-12-02 17:39:31] testing.INFO: High concurrency flash sale test completed {"database_stock":90,"redis_available":90,"redis_reserved":0,"stock_difference":0,"test_passed":true} 
[2025-12-02 17:39:36] testing.INFO: Cleared all test data  
[2025-12-02 17:39:39] testing.INFO: Cleared all test data  
[2025-12-02 17:39:39] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:39] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 17:39:39] testing.INFO: Order creation started {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295"} 
[2025-12-02 17:39:39] testing.INFO: Validating hold {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","attempt":1} 
[2025-12-02 17:39:39] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:39.608928Z","expires_at":"2025-12-02T17:41:39.609089Z","expires_at_timestamp":"1764697299","hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","status":"active","version":"2"}} 
[2025-12-02 17:39:39] testing.INFO: Hold validated successfully {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:39] testing.INFO: Hold validation successful {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","product_id":1,"quantity":1} 
[2025-12-02 17:39:39] testing.INFO: Creating order in database {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295"} 
[2025-12-02 17:39:39] testing.INFO: Order saved to database {"order_id":1,"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295"} 
[2025-12-02 17:39:39] testing.INFO: Order created successfully {"order_id":1,"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","product_id":1,"quantity":1} 
[2025-12-02 17:39:39] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_qGeO1MLnR7","order_id":999999,"status":"success"} 
[2025-12-02 17:39:39] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_qGeO1MLnR7","order_id":999999,"status":"success"} 
[2025-12-02 17:39:39] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_qGeO1MLnR7","order_id":1,"status":"success"} 
[2025-12-02 17:39:39] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"fd626894-4f2d-40c9-bd58-476792faf295","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:39:39] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:40] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 17:39:43] testing.INFO: Cleared all test data  
[2025-12-02 17:39:49] testing.INFO: Cleared all test data  
[2025-12-02 17:39:49] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:39:49] testing.INFO: === Starting data integrity test ===  
[2025-12-02 17:39:49] testing.INFO: Order creation started {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa"} 
[2025-12-02 17:39:49] testing.INFO: Validating hold {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","attempt":1} 
[2025-12-02 17:39:49] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:49.896732Z","expires_at":"2025-12-02T17:41:49.896891Z","expires_at_timestamp":"1764697309","hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","status":"active","version":"2"}} 
[2025-12-02 17:39:49] testing.INFO: Hold validated successfully {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:49] testing.INFO: Hold validation successful {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","product_id":1,"quantity":1} 
[2025-12-02 17:39:49] testing.INFO: Creating order in database {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa"} 
[2025-12-02 17:39:49] testing.INFO: Order saved to database {"order_id":1,"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa"} 
[2025-12-02 17:39:49] testing.INFO: Order created successfully {"order_id":1,"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","product_id":1,"quantity":1} 
[2025-12-02 17:39:49] testing.INFO: Payment webhook received {"idempotency_key":"integrity_nacca8N3HJ","order_id":1,"status":"success"} 
[2025-12-02 17:39:49] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"a708a9c3-989d-4691-9b35-54ca040568aa","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:39:49] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:50] testing.INFO: Order creation started {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6"} 
[2025-12-02 17:39:50] testing.INFO: Validating hold {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","attempt":1} 
[2025-12-02 17:39:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:50.030745Z","expires_at":"2025-12-02T17:41:50.031002Z","expires_at_timestamp":"1764697310","hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","status":"active","version":"4"}} 
[2025-12-02 17:39:50] testing.INFO: Hold validated successfully {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:50] testing.INFO: Hold validation successful {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Creating order in database {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6"} 
[2025-12-02 17:39:50] testing.INFO: Order saved to database {"order_id":2,"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6"} 
[2025-12-02 17:39:50] testing.INFO: Order created successfully {"order_id":2,"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment webhook received {"idempotency_key":"integrity_QAP0T6SIzM","order_id":2,"status":"failure"} 
[2025-12-02 17:39:50] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"d6b4366e-e41b-486d-99b1-df6222d678d6","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:39:50] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:39:50] testing.INFO: Order creation started {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f"} 
[2025-12-02 17:39:50] testing.INFO: Validating hold {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","attempt":1} 
[2025-12-02 17:39:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:50.220176Z","expires_at":"2025-12-02T17:41:50.220369Z","expires_at_timestamp":"1764697310","hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","status":"active","version":"6"}} 
[2025-12-02 17:39:50] testing.INFO: Hold validated successfully {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:50] testing.INFO: Hold validation successful {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Creating order in database {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f"} 
[2025-12-02 17:39:50] testing.INFO: Order saved to database {"order_id":3,"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f"} 
[2025-12-02 17:39:50] testing.INFO: Order created successfully {"order_id":3,"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment webhook received {"idempotency_key":"integrity_NEZouECAWT","order_id":3,"status":"success"} 
[2025-12-02 17:39:50] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"78359424-40f9-49e7-ad8d-713ae9cf2b2f","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:50] testing.INFO: Order creation started {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4"} 
[2025-12-02 17:39:50] testing.INFO: Validating hold {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","attempt":1} 
[2025-12-02 17:39:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:50.563767Z","expires_at":"2025-12-02T17:41:50.563920Z","expires_at_timestamp":"1764697310","hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","status":"active","version":"8"}} 
[2025-12-02 17:39:50] testing.INFO: Hold validated successfully {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:50] testing.INFO: Hold validation successful {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Creating order in database {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4"} 
[2025-12-02 17:39:50] testing.INFO: Order saved to database {"order_id":4,"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4"} 
[2025-12-02 17:39:50] testing.INFO: Order created successfully {"order_id":4,"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment webhook received {"idempotency_key":"integrity_v5rrHNwUE2","order_id":4,"status":"failure"} 
[2025-12-02 17:39:50] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"6a9745a6-8570-4343-9414-f6624b1dafb4","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:39:50] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:39:50] testing.INFO: Order creation started {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d"} 
[2025-12-02 17:39:50] testing.INFO: Validating hold {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","attempt":1} 
[2025-12-02 17:39:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:39:50.696809Z","expires_at":"2025-12-02T17:41:50.696959Z","expires_at_timestamp":"1764697310","hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","status":"active","version":"10"}} 
[2025-12-02 17:39:50] testing.INFO: Hold validated successfully {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:39:50] testing.INFO: Hold validation successful {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Creating order in database {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d"} 
[2025-12-02 17:39:50] testing.INFO: Order saved to database {"order_id":5,"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d"} 
[2025-12-02 17:39:50] testing.INFO: Order created successfully {"order_id":5,"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment webhook received {"idempotency_key":"integrity_DSdYQmwUGW","order_id":5,"status":"success"} 
[2025-12-02 17:39:50] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"dbe787d7-fbba-4eb4-bb7c-f54d0890686d","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 17:39:50] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:39:50] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 17:39:59] testing.INFO: Cleared all test data  
[2025-12-02 17:40:03] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:40:03.603443Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:40:04] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:40:07] testing.INFO: Cleared all test data  
[2025-12-02 17:40:07] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:40:07] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 17:40:07] testing.INFO: Order creation started {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3"} 
[2025-12-02 17:40:07] testing.INFO: Validating hold {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","attempt":1} 
[2025-12-02 17:40:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:40:07.942953Z","expires_at":"2025-12-02T17:42:07.943088Z","expires_at_timestamp":"1764697327","hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","status":"active","version":"2"}} 
[2025-12-02 17:40:07] testing.INFO: Hold validated successfully {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:40:07] testing.INFO: Hold validation successful {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","product_id":1,"quantity":1} 
[2025-12-02 17:40:07] testing.INFO: Creating order in database {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3"} 
[2025-12-02 17:40:07] testing.INFO: Order saved to database {"order_id":1,"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3"} 
[2025-12-02 17:40:07] testing.INFO: Order created successfully {"order_id":1,"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","product_id":1,"quantity":1} 
[2025-12-02 17:40:07] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_Q7D4XBOqV9","order_id":1,"status":"success"} 
[2025-12-02 17:40:08] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"dbb01826-c19a-4f25-a388-dd49b13d7cc3","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:40:08] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:40:08] testing.INFO: Redis transaction consistency test passed {"order_id":1} 
[2025-12-02 17:40:12] testing.INFO: Cleared all test data  
[2025-12-02 17:41:04] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:41:04.956208Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:41:05] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:42:05] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:42:05.890836Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:42:06] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:43:07] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:43:07.448667Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:43:08] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:44:08] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:44:08.484216Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:44:08] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:45:09] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:45:09.639727Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:45:10] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:46:10] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:46:10.897623Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:46:11] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:47:12] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:47:12.120813Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:47:12] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:48:13] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:48:13.307758Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:48:14] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:49:14] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:49:14.262920Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:49:14] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:50:15] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:50:15.339320Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:50:16] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:51:16] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:51:16.643875Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:51:17] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:52:18] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:52:18.006743Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:52:18] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:53:18] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:53:18.932670Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:53:19] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:54:20] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:54:20.209853Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:54:21] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:54:21] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"test-expired-hold-1764698061","product_id":1,"quantity":2} 
[2025-12-02 17:54:21] testing.INFO: Hold DELETED (expired) {"hold_id":"test-expired-hold-1764698061","product_id":1,"quantity_restored":2,"stock_released":true} 
[2025-12-02 17:54:21] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"test-expired-hold-1764698061"} 
[2025-12-02 17:54:21] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.03} 
[2025-12-02 17:54:22] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:54:24] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 17:54:26] testing.INFO: Attempting to expire hold via HoldManagementService {"hold_id":"poc-test-692f27d275392","product_id":777,"quantity":1} 
[2025-12-02 17:54:26] testing.INFO: Hold DELETED (expired) {"hold_id":"poc-test-692f27d275392","product_id":777,"quantity_restored":1,"stock_released":true} 
[2025-12-02 17:54:26] testing.DEBUG: Hold expired successfully via HoldManagementService {"hold_id":"poc-test-692f27d275392"} 
[2025-12-02 17:54:26] testing.INFO: Expired holds processing completed {"processed_count":1,"expired_count":1,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:54:26] testing.DEBUG: Stock oversell logic test took: 0.01ms  
[2025-12-02 17:54:34] testing.INFO: Cleared all test data  
[2025-12-02 17:54:34] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:54:34] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 17:54:34] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 17:54:34] testing.INFO: Hold created {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","product_id":1} 
[2025-12-02 17:54:34] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 17:54:34] testing.INFO: Order creation started {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a"} 
[2025-12-02 17:54:34] testing.INFO: Validating hold {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","attempt":1} 
[2025-12-02 17:54:34] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:54:34.251102Z","expires_at":"2025-12-02T17:56:34.251280Z","expires_at_timestamp":"1764698194","hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","status":"active","version":"2"}} 
[2025-12-02 17:54:34] testing.INFO: Hold validated successfully {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:54:34] testing.INFO: Hold validation successful {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","product_id":1,"quantity":2} 
[2025-12-02 17:54:34] testing.INFO: Creating order in database {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a"} 
[2025-12-02 17:54:34] testing.INFO: Order saved to database {"order_id":1,"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a"} 
[2025-12-02 17:54:34] testing.INFO: Order created successfully {"order_id":1,"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","product_id":1,"quantity":2} 
[2025-12-02 17:54:34] testing.INFO: Order created {"order_id":1,"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a"} 
[2025-12-02 17:54:34] testing.INFO: Payment webhook received {"idempotency_key":"test_key_BnWWhoY3tM","order_id":1,"status":"success"} 
[2025-12-02 17:54:34] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"44a112ce-d780-4a73-ba57-9235549d734a","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:54:34] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:54:34] testing.INFO: Basic payment flow test passed {"order_id":1,"final_stock":98} 
[2025-12-02 17:54:37] testing.INFO: Cleared all test data  
[2025-12-02 17:54:40] testing.INFO: Cleared all test data  
[2025-12-02 17:54:40] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:54:40] testing.INFO: === Debug hold creation ===  
[2025-12-02 17:54:40] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 17:54:40] testing.INFO: Hold created successfully {"hold_id":"55bdc958-b1f5-4e54-a384-b7e984015931","expires_at":"2025-12-02T17:56:40.851903Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 17:54:46] testing.INFO: Cleared all test data  
[2025-12-02 17:54:49] testing.INFO: Cleared all test data  
[2025-12-02 17:54:50] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:54:50] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 17:54:50] testing.INFO: Order creation started {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9"} 
[2025-12-02 17:54:50] testing.INFO: Validating hold {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","attempt":1} 
[2025-12-02 17:54:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:54:50.150218Z","expires_at":"2025-12-02T17:56:50.150390Z","expires_at_timestamp":"1764698210","hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","status":"active","version":"2"}} 
[2025-12-02 17:54:50] testing.INFO: Hold validated successfully {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:54:50] testing.INFO: Hold validation successful {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","product_id":1,"quantity":1} 
[2025-12-02 17:54:50] testing.INFO: Creating order in database {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9"} 
[2025-12-02 17:54:50] testing.INFO: Order saved to database {"order_id":1,"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9"} 
[2025-12-02 17:54:50] testing.INFO: Order created successfully {"order_id":1,"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","product_id":1,"quantity":1} 
[2025-12-02 17:54:50] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_Qu6yYb0B1C","order_id":1,"status":"success"} 
[2025-12-02 17:54:50] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"6cab4aa4-b8b4-4249-bd9a-ddfb9e0a47c9","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:54:50] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:54:50] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_Qu6yYb0B1C","order_id":1,"status":"success"} 
[2025-12-02 17:54:50] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 17:54:50] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_Qu6yYb0B1C"} 
[2025-12-02 17:54:53] testing.INFO: Cleared all test data  
[2025-12-02 17:54:57] testing.INFO: Cleared all test data  
[2025-12-02 17:54:57] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:54:58] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 17:54:58] testing.INFO: Order creation started {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c"} 
[2025-12-02 17:54:58] testing.INFO: Validating hold {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","attempt":1} 
[2025-12-02 17:54:58] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T17:54:58.038241Z","expires_at":"2025-12-02T17:56:58.038404Z","expires_at_timestamp":"1764698218","hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","status":"active","version":"2"}} 
[2025-12-02 17:54:58] testing.INFO: Hold validated successfully {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 17:54:58] testing.INFO: Hold validation successful {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","product_id":1,"quantity":3} 
[2025-12-02 17:54:58] testing.INFO: Creating order in database {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c"} 
[2025-12-02 17:54:58] testing.INFO: Order saved to database {"order_id":1,"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c"} 
[2025-12-02 17:54:58] testing.INFO: Order created successfully {"order_id":1,"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","product_id":1,"quantity":3} 
[2025-12-02 17:54:58] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_Yg49ERrEuH","order_id":1,"status":"failure"} 
[2025-12-02 17:54:58] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"5f6fb789-5ee9-43ca-8256-fa01f3a0fb3c","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 17:54:58] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:54:58] testing.INFO: Failed payment flow test passed {"order_id":1,"stock_restored":true} 
[2025-12-02 17:55:02] testing.INFO: Cleared all test data  
[2025-12-02 17:55:06] testing.INFO: Cleared all test data  
[2025-12-02 17:55:06] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:55:06] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 17:55:06] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 17:55:06] testing.DEBUG: Hold created {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 17:55:06] testing.DEBUG: Hold created {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 17:55:06] testing.DEBUG: Hold created {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 17:55:06] testing.DEBUG: Hold created {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 17:55:06] testing.DEBUG: Hold created {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 17:55:06] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 17:55:06] testing.INFO: Order creation started {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498"} 
[2025-12-02 17:55:06] testing.INFO: Validating hold {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","attempt":1} 
[2025-12-02 17:55:06] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:55:06.806054Z","expires_at":"2025-12-02T17:57:06.806210Z","expires_at_timestamp":"1764698226","hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","status":"active","version":"2"}} 
[2025-12-02 17:55:06] testing.INFO: Hold validated successfully {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:55:06] testing.INFO: Hold validation successful {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","product_id":1,"quantity":2} 
[2025-12-02 17:55:06] testing.INFO: Creating order in database {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498"} 
[2025-12-02 17:55:06] testing.INFO: Order saved to database {"order_id":1,"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498"} 
[2025-12-02 17:55:07] testing.INFO: Order created successfully {"order_id":1,"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.DEBUG: Order created {"order_id":1,"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Order creation started {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6"} 
[2025-12-02 17:55:07] testing.INFO: Validating hold {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","attempt":1} 
[2025-12-02 17:55:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:55:06.810138Z","expires_at":"2025-12-02T17:57:06.810324Z","expires_at_timestamp":"1764698226","hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","status":"active","version":"3"}} 
[2025-12-02 17:55:07] testing.INFO: Hold validated successfully {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:55:07] testing.INFO: Hold validation successful {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Creating order in database {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6"} 
[2025-12-02 17:55:07] testing.INFO: Order saved to database {"order_id":2,"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6"} 
[2025-12-02 17:55:07] testing.INFO: Order created successfully {"order_id":2,"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.DEBUG: Order created {"order_id":2,"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Order creation started {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849"} 
[2025-12-02 17:55:07] testing.INFO: Validating hold {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","attempt":1} 
[2025-12-02 17:55:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:55:06.813664Z","expires_at":"2025-12-02T17:57:06.813826Z","expires_at_timestamp":"1764698226","hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","status":"active","version":"4"}} 
[2025-12-02 17:55:07] testing.INFO: Hold validated successfully {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:55:07] testing.INFO: Hold validation successful {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Creating order in database {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849"} 
[2025-12-02 17:55:07] testing.INFO: Order saved to database {"order_id":3,"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849"} 
[2025-12-02 17:55:07] testing.INFO: Order created successfully {"order_id":3,"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.DEBUG: Order created {"order_id":3,"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Order creation started {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d"} 
[2025-12-02 17:55:07] testing.INFO: Validating hold {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","attempt":1} 
[2025-12-02 17:55:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:55:06.817687Z","expires_at":"2025-12-02T17:57:06.817851Z","expires_at_timestamp":"1764698226","hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","status":"active","version":"5"}} 
[2025-12-02 17:55:07] testing.INFO: Hold validated successfully {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:55:07] testing.INFO: Hold validation successful {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Creating order in database {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d"} 
[2025-12-02 17:55:07] testing.INFO: Order saved to database {"order_id":4,"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d"} 
[2025-12-02 17:55:07] testing.INFO: Order created successfully {"order_id":4,"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.DEBUG: Order created {"order_id":4,"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Order creation started {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f"} 
[2025-12-02 17:55:07] testing.INFO: Validating hold {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","attempt":1} 
[2025-12-02 17:55:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T17:55:06.821211Z","expires_at":"2025-12-02T17:57:06.821360Z","expires_at_timestamp":"1764698226","hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","status":"active","version":"6"}} 
[2025-12-02 17:55:07] testing.INFO: Hold validated successfully {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 17:55:07] testing.INFO: Hold validation successful {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Creating order in database {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f"} 
[2025-12-02 17:55:07] testing.INFO: Order saved to database {"order_id":5,"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f"} 
[2025-12-02 17:55:07] testing.INFO: Order created successfully {"order_id":5,"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.DEBUG: Order created {"order_id":5,"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 17:55:07] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_Ao6ywgEfWl","order_id":1,"status":"success"} 
[2025-12-02 17:55:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:07] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 17:55:07] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_62TSvHLh24","order_id":2,"status":"success"} 
[2025-12-02 17:55:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:07] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 17:55:07] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_FrY8OqgCgo","order_id":3,"status":"success"} 
[2025-12-02 17:55:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:07] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 17:55:07] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_yn8J2u25WJ","order_id":4,"status":"success"} 
[2025-12-02 17:55:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:07] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 17:55:07] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_guyDiXEjjT","order_id":5,"status":"success"} 
[2025-12-02 17:55:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 17:55:07] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:07] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 17:55:07] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 17:55:07] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498"} 
[2025-12-02 17:55:07] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"184fa92f-127a-400f-8e21-36d71daccde6"} 
[2025-12-02 17:55:07] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849"} 
[2025-12-02 17:55:07] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d"} 
[2025-12-02 17:55:07] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f"} 
[2025-12-02 17:55:07] testing.DEBUG: Hold state {"hold_id":"fe279db6-2c00-42a1-aea9-8dce4448b498","status":"unknown","quantity":2} 
[2025-12-02 17:55:08] testing.DEBUG: Hold state {"hold_id":"184fa92f-127a-400f-8e21-36d71daccde6","status":"unknown","quantity":2} 
[2025-12-02 17:55:08] testing.DEBUG: Hold state {"hold_id":"77fb4a38-f803-4f98-814c-b1cc81634849","status":"unknown","quantity":2} 
[2025-12-02 17:55:08] testing.DEBUG: Hold state {"hold_id":"edc8797d-3d31-44a8-b53b-4f579f42a16d","status":"unknown","quantity":2} 
[2025-12-02 17:55:08] testing.DEBUG: Hold state {"hold_id":"c69ff4db-e581-4c6f-bb51-ddd575b4a40f","status":"unknown","quantity":2} 
[2025-12-02 17:55:08] testing.INFO: High concurrency flash sale test completed {"database_stock":90,"redis_available":90,"redis_reserved":0,"stock_difference":0,"test_passed":true} 
[2025-12-02 17:55:14] testing.INFO: Cleared all test data  
[2025-12-02 17:55:18] testing.INFO: Cleared all test data  
[2025-12-02 17:55:18] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:55:18] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 17:55:18] testing.INFO: Order creation started {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62"} 
[2025-12-02 17:55:18] testing.INFO: Validating hold {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","attempt":1} 
[2025-12-02 17:55:18] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:18.449580Z","expires_at":"2025-12-02T17:57:18.449738Z","expires_at_timestamp":"1764698238","hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","status":"active","version":"2"}} 
[2025-12-02 17:55:18] testing.INFO: Hold validated successfully {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:18] testing.INFO: Hold validation successful {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","product_id":1,"quantity":1} 
[2025-12-02 17:55:18] testing.INFO: Creating order in database {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62"} 
[2025-12-02 17:55:18] testing.INFO: Order saved to database {"order_id":1,"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62"} 
[2025-12-02 17:55:18] testing.INFO: Order created successfully {"order_id":1,"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","product_id":1,"quantity":1} 
[2025-12-02 17:55:18] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_CScKeQ8Mug","order_id":999999,"status":"success"} 
[2025-12-02 17:55:18] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_CScKeQ8Mug","order_id":999999,"status":"success"} 
[2025-12-02 17:55:18] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_CScKeQ8Mug","order_id":1,"status":"success"} 
[2025-12-02 17:55:18] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"39f942d7-7a13-4bb9-91d5-77189d4b9c62","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:55:18] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:18] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 17:55:21] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:55:21.469608Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:55:22] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:55:24] testing.INFO: Cleared all test data  
[2025-12-02 17:55:30] testing.INFO: Cleared all test data  
[2025-12-02 17:55:30] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:55:30] testing.INFO: === Starting data integrity test ===  
[2025-12-02 17:55:30] testing.INFO: Order creation started {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455"} 
[2025-12-02 17:55:30] testing.INFO: Validating hold {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","attempt":1} 
[2025-12-02 17:55:30] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:30.821103Z","expires_at":"2025-12-02T17:57:30.821293Z","expires_at_timestamp":"1764698250","hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","status":"active","version":"2"}} 
[2025-12-02 17:55:30] testing.INFO: Hold validated successfully {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:30] testing.INFO: Hold validation successful {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","product_id":1,"quantity":1} 
[2025-12-02 17:55:30] testing.INFO: Creating order in database {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455"} 
[2025-12-02 17:55:30] testing.INFO: Order saved to database {"order_id":1,"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455"} 
[2025-12-02 17:55:30] testing.INFO: Order created successfully {"order_id":1,"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","product_id":1,"quantity":1} 
[2025-12-02 17:55:30] testing.INFO: Payment webhook received {"idempotency_key":"integrity_HFDkY3wcxv","order_id":1,"status":"success"} 
[2025-12-02 17:55:30] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"58e6c368-dba6-4ffc-9b28-a7183731a455","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:55:30] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:31] testing.INFO: Order creation started {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf"} 
[2025-12-02 17:55:31] testing.INFO: Validating hold {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","attempt":1} 
[2025-12-02 17:55:31] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:31.061224Z","expires_at":"2025-12-02T17:57:31.061381Z","expires_at_timestamp":"1764698251","hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","status":"active","version":"4"}} 
[2025-12-02 17:55:31] testing.INFO: Hold validated successfully {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:31] testing.INFO: Hold validation successful {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Creating order in database {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf"} 
[2025-12-02 17:55:31] testing.INFO: Order saved to database {"order_id":2,"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf"} 
[2025-12-02 17:55:31] testing.INFO: Order created successfully {"order_id":2,"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment webhook received {"idempotency_key":"integrity_MNWDFBK8hO","order_id":2,"status":"failure"} 
[2025-12-02 17:55:31] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"82d1abb4-ab70-48f6-bd01-5e10d41497cf","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:55:31] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:55:31] testing.INFO: Order creation started {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f"} 
[2025-12-02 17:55:31] testing.INFO: Validating hold {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","attempt":1} 
[2025-12-02 17:55:31] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:31.326749Z","expires_at":"2025-12-02T17:57:31.326954Z","expires_at_timestamp":"1764698251","hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","status":"active","version":"6"}} 
[2025-12-02 17:55:31] testing.INFO: Hold validated successfully {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:31] testing.INFO: Hold validation successful {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Creating order in database {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f"} 
[2025-12-02 17:55:31] testing.INFO: Order saved to database {"order_id":3,"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f"} 
[2025-12-02 17:55:31] testing.INFO: Order created successfully {"order_id":3,"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment webhook received {"idempotency_key":"integrity_m3CyVZQzoF","order_id":3,"status":"success"} 
[2025-12-02 17:55:31] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"51a94d20-3dcb-4228-81b0-269baf70565f","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:31] testing.INFO: Order creation started {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be"} 
[2025-12-02 17:55:31] testing.INFO: Validating hold {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","attempt":1} 
[2025-12-02 17:55:31] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:31.471240Z","expires_at":"2025-12-02T17:57:31.471399Z","expires_at_timestamp":"1764698251","hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","status":"active","version":"8"}} 
[2025-12-02 17:55:31] testing.INFO: Hold validated successfully {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:31] testing.INFO: Hold validation successful {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Creating order in database {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be"} 
[2025-12-02 17:55:31] testing.INFO: Order saved to database {"order_id":4,"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be"} 
[2025-12-02 17:55:31] testing.INFO: Order created successfully {"order_id":4,"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment webhook received {"idempotency_key":"integrity_vMv4nZaLor","order_id":4,"status":"failure"} 
[2025-12-02 17:55:31] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"b119e30c-0e80-4a5e-bf97-ee86d37668be","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 17:55:31] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 17:55:31] testing.INFO: Order creation started {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d"} 
[2025-12-02 17:55:31] testing.INFO: Validating hold {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","attempt":1} 
[2025-12-02 17:55:31] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:31.606360Z","expires_at":"2025-12-02T17:57:31.606556Z","expires_at_timestamp":"1764698251","hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","status":"active","version":"10"}} 
[2025-12-02 17:55:31] testing.INFO: Hold validated successfully {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:31] testing.INFO: Hold validation successful {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Creating order in database {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d"} 
[2025-12-02 17:55:31] testing.INFO: Order saved to database {"order_id":5,"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d"} 
[2025-12-02 17:55:31] testing.INFO: Order created successfully {"order_id":5,"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment webhook received {"idempotency_key":"integrity_otgEBwpxd0","order_id":5,"status":"success"} 
[2025-12-02 17:55:31] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"32d5f3d2-6a0d-4b45-b0d3-aa83751c084d","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 17:55:31] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:32] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 17:55:36] testing.INFO: Cleared all test data  
[2025-12-02 17:55:42] testing.INFO: Cleared all test data  
[2025-12-02 17:55:42] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 17:55:42] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 17:55:42] testing.INFO: Order creation started {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad"} 
[2025-12-02 17:55:42] testing.INFO: Validating hold {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","attempt":1} 
[2025-12-02 17:55:42] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T17:55:42.260998Z","expires_at":"2025-12-02T17:57:42.261162Z","expires_at_timestamp":"1764698262","hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","status":"active","version":"2"}} 
[2025-12-02 17:55:42] testing.INFO: Hold validated successfully {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 17:55:42] testing.INFO: Hold validation successful {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","product_id":1,"quantity":1} 
[2025-12-02 17:55:42] testing.INFO: Creating order in database {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad"} 
[2025-12-02 17:55:42] testing.INFO: Order saved to database {"order_id":1,"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad"} 
[2025-12-02 17:55:42] testing.INFO: Order created successfully {"order_id":1,"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","product_id":1,"quantity":1} 
[2025-12-02 17:55:42] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_30uKpoFcNu","order_id":1,"status":"success"} 
[2025-12-02 17:55:42] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"e99e18f9-5f3e-49fe-844a-c47cf6a678ad","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 17:55:42] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 17:55:42] testing.INFO: Redis transaction consistency test passed {"order_id":1} 
[2025-12-02 17:55:45] testing.INFO: Cleared all test data  
[2025-12-02 17:56:22] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:56:22.587708Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:56:23] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 17:57:23] local.INFO: SCHEDULER_HEARTBEAT {"timestamp":"2025-12-02T17:57:23.722168Z","holds_total":0,"available_stock_1":null,"reserved_stock_1":null} 
[2025-12-02 17:57:24] local.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.01} 
[2025-12-02 18:16:32] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:16:33] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:16:35] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:16:37] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:16:37] testing.DEBUG: Stock oversell logic test took: 0.02ms  
[2025-12-02 18:16:44] testing.INFO: Cleared all test data  
[2025-12-02 18:16:44] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:16:45] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 18:16:45] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 18:16:45] testing.INFO: Hold created {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","product_id":1} 
[2025-12-02 18:16:45] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 18:16:45] testing.INFO: Order creation started {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841"} 
[2025-12-02 18:16:45] testing.INFO: Validating hold {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","attempt":1} 
[2025-12-02 18:16:45] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:16:45.071009Z","expires_at":"2025-12-02T18:18:45.071183Z","expires_at_timestamp":"1764699525","hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","status":"active","version":"2"}} 
[2025-12-02 18:16:45] testing.INFO: Hold validated successfully {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:16:45] testing.INFO: Hold validation successful {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","product_id":1,"quantity":2} 
[2025-12-02 18:16:45] testing.INFO: Creating order in database {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841"} 
[2025-12-02 18:16:45] testing.INFO: Order saved to database {"order_id":1,"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841"} 
[2025-12-02 18:16:45] testing.INFO: Order created successfully {"order_id":1,"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","product_id":1,"quantity":2} 
[2025-12-02 18:16:45] testing.INFO: Order created {"order_id":1,"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841"} 
[2025-12-02 18:16:45] testing.INFO: Payment webhook received {"idempotency_key":"test_key_kUrIM4JGjD","order_id":1,"status":"success"} 
[2025-12-02 18:16:45] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"7c75d284-1f6d-4fad-98db-6ad17fde3841","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:16:45] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:16:45] testing.INFO: Basic payment flow test passed {"order_id":1,"final_stock":98} 
[2025-12-02 18:16:48] testing.INFO: Cleared all test data  
[2025-12-02 18:16:51] testing.INFO: Cleared all test data  
[2025-12-02 18:16:52] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:16:52] testing.INFO: === Debug hold creation ===  
[2025-12-02 18:16:52] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 18:16:52] testing.INFO: Hold created successfully {"hold_id":"301caaed-c6a1-4e31-8226-210989877f9d","expires_at":"2025-12-02T18:18:52.105933Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 18:16:56] testing.INFO: Cleared all test data  
[2025-12-02 18:17:02] testing.INFO: Cleared all test data  
[2025-12-02 18:17:02] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:03] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 18:17:03] testing.INFO: Order creation started {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf"} 
[2025-12-02 18:17:03] testing.INFO: Validating hold {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","attempt":1} 
[2025-12-02 18:17:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:03.004336Z","expires_at":"2025-12-02T18:19:03.004504Z","expires_at_timestamp":"1764699543","hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","status":"active","version":"2"}} 
[2025-12-02 18:17:03] testing.INFO: Hold validated successfully {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:03] testing.INFO: Hold validation successful {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","product_id":1,"quantity":1} 
[2025-12-02 18:17:03] testing.INFO: Creating order in database {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf"} 
[2025-12-02 18:17:03] testing.INFO: Order saved to database {"order_id":1,"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf"} 
[2025-12-02 18:17:03] testing.INFO: Order created successfully {"order_id":1,"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","product_id":1,"quantity":1} 
[2025-12-02 18:17:03] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_2tMHx8rgOp","order_id":1,"status":"success"} 
[2025-12-02 18:17:03] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"5853e64c-74fb-44a3-9f48-03f130e096bf","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:17:03] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:03] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_2tMHx8rgOp","order_id":1,"status":"success"} 
[2025-12-02 18:17:03] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 18:17:03] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_2tMHx8rgOp"} 
[2025-12-02 18:17:07] testing.INFO: Cleared all test data  
[2025-12-02 18:17:13] testing.INFO: Cleared all test data  
[2025-12-02 18:17:13] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:13] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 18:17:13] testing.INFO: Order creation started {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11"} 
[2025-12-02 18:17:13] testing.INFO: Validating hold {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","attempt":1} 
[2025-12-02 18:17:13] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T18:17:13.792176Z","expires_at":"2025-12-02T18:19:13.792299Z","expires_at_timestamp":"1764699553","hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","status":"active","version":"2"}} 
[2025-12-02 18:17:13] testing.INFO: Hold validated successfully {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 18:17:13] testing.INFO: Hold validation successful {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","product_id":1,"quantity":3} 
[2025-12-02 18:17:13] testing.INFO: Creating order in database {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11"} 
[2025-12-02 18:17:13] testing.INFO: Order saved to database {"order_id":1,"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11"} 
[2025-12-02 18:17:13] testing.INFO: Order created successfully {"order_id":1,"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","product_id":1,"quantity":3} 
[2025-12-02 18:17:13] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_IEUwNA4BJy","order_id":1,"status":"failure"} 
[2025-12-02 18:17:14] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"9b08248b-d424-4a9e-9635-81ff33b40f11","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 18:17:14] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:17:14] testing.INFO: Failed payment flow test passed {"order_id":1,"stock_restored":true} 
[2025-12-02 18:17:17] testing.INFO: Cleared all test data  
[2025-12-02 18:17:20] testing.INFO: Cleared all test data  
[2025-12-02 18:17:20] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:20] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 18:17:20] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 18:17:20] testing.DEBUG: Hold created {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 18:17:20] testing.DEBUG: Hold created {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 18:17:20] testing.DEBUG: Hold created {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 18:17:20] testing.DEBUG: Hold created {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 18:17:20] testing.DEBUG: Hold created {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 18:17:20] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 18:17:20] testing.INFO: Order creation started {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02"} 
[2025-12-02 18:17:20] testing.INFO: Validating hold {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","attempt":1} 
[2025-12-02 18:17:20] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:17:20.827022Z","expires_at":"2025-12-02T18:19:20.827242Z","expires_at_timestamp":"1764699560","hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","status":"active","version":"2"}} 
[2025-12-02 18:17:20] testing.INFO: Hold validated successfully {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:17:20] testing.INFO: Hold validation successful {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","product_id":1,"quantity":2} 
[2025-12-02 18:17:20] testing.INFO: Creating order in database {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02"} 
[2025-12-02 18:17:20] testing.INFO: Order saved to database {"order_id":1,"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02"} 
[2025-12-02 18:17:20] testing.INFO: Order created successfully {"order_id":1,"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","product_id":1,"quantity":2} 
[2025-12-02 18:17:20] testing.DEBUG: Order created {"order_id":1,"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","quantity":2} 
[2025-12-02 18:17:20] testing.INFO: Order creation started {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67"} 
[2025-12-02 18:17:20] testing.INFO: Validating hold {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","attempt":1} 
[2025-12-02 18:17:20] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:17:20.831400Z","expires_at":"2025-12-02T18:19:20.831718Z","expires_at_timestamp":"1764699560","hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","status":"active","version":"3"}} 
[2025-12-02 18:17:20] testing.INFO: Hold validated successfully {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:17:20] testing.INFO: Hold validation successful {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","product_id":1,"quantity":2} 
[2025-12-02 18:17:20] testing.INFO: Creating order in database {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67"} 
[2025-12-02 18:17:20] testing.INFO: Order saved to database {"order_id":2,"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67"} 
[2025-12-02 18:17:21] testing.INFO: Order created successfully {"order_id":2,"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.DEBUG: Order created {"order_id":2,"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Order creation started {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721"} 
[2025-12-02 18:17:21] testing.INFO: Validating hold {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","attempt":1} 
[2025-12-02 18:17:21] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:17:20.835749Z","expires_at":"2025-12-02T18:19:20.835934Z","expires_at_timestamp":"1764699560","hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","status":"active","version":"4"}} 
[2025-12-02 18:17:21] testing.INFO: Hold validated successfully {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:17:21] testing.INFO: Hold validation successful {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Creating order in database {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721"} 
[2025-12-02 18:17:21] testing.INFO: Order saved to database {"order_id":3,"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721"} 
[2025-12-02 18:17:21] testing.INFO: Order created successfully {"order_id":3,"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.DEBUG: Order created {"order_id":3,"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Order creation started {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23"} 
[2025-12-02 18:17:21] testing.INFO: Validating hold {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","attempt":1} 
[2025-12-02 18:17:21] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:17:20.839573Z","expires_at":"2025-12-02T18:19:20.839734Z","expires_at_timestamp":"1764699560","hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","status":"active","version":"5"}} 
[2025-12-02 18:17:21] testing.INFO: Hold validated successfully {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:17:21] testing.INFO: Hold validation successful {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Creating order in database {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23"} 
[2025-12-02 18:17:21] testing.INFO: Order saved to database {"order_id":4,"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23"} 
[2025-12-02 18:17:21] testing.INFO: Order created successfully {"order_id":4,"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.DEBUG: Order created {"order_id":4,"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Order creation started {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf"} 
[2025-12-02 18:17:21] testing.INFO: Validating hold {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","attempt":1} 
[2025-12-02 18:17:21] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:17:20.844552Z","expires_at":"2025-12-02T18:19:20.844703Z","expires_at_timestamp":"1764699560","hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","status":"active","version":"6"}} 
[2025-12-02 18:17:21] testing.INFO: Hold validated successfully {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:17:21] testing.INFO: Hold validation successful {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Creating order in database {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf"} 
[2025-12-02 18:17:21] testing.INFO: Order saved to database {"order_id":5,"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf"} 
[2025-12-02 18:17:21] testing.INFO: Order created successfully {"order_id":5,"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.DEBUG: Order created {"order_id":5,"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 18:17:21] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_oeYx1WoGOf","order_id":1,"status":"success"} 
[2025-12-02 18:17:21] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:21] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 18:17:21] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_fJUN5v8kP8","order_id":2,"status":"success"} 
[2025-12-02 18:17:21] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:21] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 18:17:21] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_o1LpP7JyJw","order_id":3,"status":"success"} 
[2025-12-02 18:17:21] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:21] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 18:17:21] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_qwClTHj1jN","order_id":4,"status":"success"} 
[2025-12-02 18:17:21] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 18:17:21] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:21] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 18:17:21] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_bCtLUmTdH2","order_id":5,"status":"success"} 
[2025-12-02 18:17:22] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 18:17:22] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:22] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 18:17:22] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 18:17:22] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02"} 
[2025-12-02 18:17:22] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67"} 
[2025-12-02 18:17:22] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"1a200e20-c151-4891-844f-e6ba9510a721"} 
[2025-12-02 18:17:22] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"e664edfa-c072-47da-8053-29a4c6172c23"} 
[2025-12-02 18:17:22] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf"} 
[2025-12-02 18:17:22] testing.DEBUG: Hold state {"hold_id":"80763bb8-237c-4e0a-8309-e066c055fd02","status":"unknown","quantity":2} 
[2025-12-02 18:17:22] testing.DEBUG: Hold state {"hold_id":"283ebe8f-87fb-4e22-917e-b7e969ee3f67","status":"unknown","quantity":2} 
[2025-12-02 18:17:22] testing.DEBUG: Hold state {"hold_id":"1a200e20-c151-4891-844f-e6ba9510a721","status":"unknown","quantity":2} 
[2025-12-02 18:17:22] testing.DEBUG: Hold state {"hold_id":"e664edfa-c072-47da-8053-29a4c6172c23","status":"unknown","quantity":2} 
[2025-12-02 18:17:22] testing.DEBUG: Hold state {"hold_id":"b75e228f-15d0-47b4-bc8f-ba928a7ce0bf","status":"unknown","quantity":2} 
[2025-12-02 18:17:22] testing.INFO: High concurrency flash sale test completed {"database_stock":90,"redis_available":90,"redis_reserved":0,"stock_difference":0,"test_passed":true} 
[2025-12-02 18:17:27] testing.INFO: Cleared all test data  
[2025-12-02 18:17:31] testing.INFO: Cleared all test data  
[2025-12-02 18:17:31] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:31] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 18:17:31] testing.INFO: Order creation started {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925"} 
[2025-12-02 18:17:31] testing.INFO: Validating hold {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","attempt":1} 
[2025-12-02 18:17:31] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:31.249044Z","expires_at":"2025-12-02T18:19:31.249172Z","expires_at_timestamp":"1764699571","hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","status":"active","version":"2"}} 
[2025-12-02 18:17:31] testing.INFO: Hold validated successfully {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:31] testing.INFO: Hold validation successful {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","product_id":1,"quantity":1} 
[2025-12-02 18:17:31] testing.INFO: Creating order in database {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925"} 
[2025-12-02 18:17:31] testing.INFO: Order saved to database {"order_id":1,"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925"} 
[2025-12-02 18:17:31] testing.INFO: Order created successfully {"order_id":1,"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","product_id":1,"quantity":1} 
[2025-12-02 18:17:31] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_I57wevtYYY","order_id":999999,"status":"success"} 
[2025-12-02 18:17:31] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_I57wevtYYY","order_id":999999,"status":"success"} 
[2025-12-02 18:17:31] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_I57wevtYYY","order_id":1,"status":"success"} 
[2025-12-02 18:17:31] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"f95c9f2a-1d2e-4325-9993-2e62257c5925","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:17:31] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:31] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 18:17:34] testing.INFO: Cleared all test data  
[2025-12-02 18:17:40] testing.INFO: Cleared all test data  
[2025-12-02 18:17:40] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:40] testing.INFO: === Starting data integrity test ===  
[2025-12-02 18:17:40] testing.INFO: Order creation started {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222"} 
[2025-12-02 18:17:40] testing.INFO: Validating hold {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","attempt":1} 
[2025-12-02 18:17:40] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:40.891823Z","expires_at":"2025-12-02T18:19:40.891980Z","expires_at_timestamp":"1764699580","hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","status":"active","version":"2"}} 
[2025-12-02 18:17:40] testing.INFO: Hold validated successfully {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:40] testing.INFO: Hold validation successful {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","product_id":1,"quantity":1} 
[2025-12-02 18:17:40] testing.INFO: Creating order in database {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222"} 
[2025-12-02 18:17:40] testing.INFO: Order saved to database {"order_id":1,"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222"} 
[2025-12-02 18:17:41] testing.INFO: Order created successfully {"order_id":1,"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment webhook received {"idempotency_key":"integrity_8rK6fsLu6l","order_id":1,"status":"success"} 
[2025-12-02 18:17:41] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"e9ac4aec-6ba4-4f8c-b03a-67f2c6be1222","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:41] testing.INFO: Order creation started {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472"} 
[2025-12-02 18:17:41] testing.INFO: Validating hold {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","attempt":1} 
[2025-12-02 18:17:41] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:41.270432Z","expires_at":"2025-12-02T18:19:41.270580Z","expires_at_timestamp":"1764699581","hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","status":"active","version":"4"}} 
[2025-12-02 18:17:41] testing.INFO: Hold validated successfully {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:41] testing.INFO: Hold validation successful {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Creating order in database {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472"} 
[2025-12-02 18:17:41] testing.INFO: Order saved to database {"order_id":2,"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472"} 
[2025-12-02 18:17:41] testing.INFO: Order created successfully {"order_id":2,"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment webhook received {"idempotency_key":"integrity_X9oYaN2L0s","order_id":2,"status":"failure"} 
[2025-12-02 18:17:41] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"e32ab4ac-0ea3-4065-8abc-b022d95a9472","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:17:41] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:17:41] testing.INFO: Order creation started {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784"} 
[2025-12-02 18:17:41] testing.INFO: Validating hold {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","attempt":1} 
[2025-12-02 18:17:41] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:41.403141Z","expires_at":"2025-12-02T18:19:41.403302Z","expires_at_timestamp":"1764699581","hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","status":"active","version":"6"}} 
[2025-12-02 18:17:41] testing.INFO: Hold validated successfully {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:41] testing.INFO: Hold validation successful {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Creating order in database {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784"} 
[2025-12-02 18:17:41] testing.INFO: Order saved to database {"order_id":3,"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784"} 
[2025-12-02 18:17:41] testing.INFO: Order created successfully {"order_id":3,"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment webhook received {"idempotency_key":"integrity_iOtSKeSgxC","order_id":3,"status":"success"} 
[2025-12-02 18:17:41] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"ee1bc3fe-c275-4cd5-bd69-05621d053784","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:41] testing.INFO: Order creation started {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8"} 
[2025-12-02 18:17:41] testing.INFO: Validating hold {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","attempt":1} 
[2025-12-02 18:17:41] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:41.603061Z","expires_at":"2025-12-02T18:19:41.603211Z","expires_at_timestamp":"1764699581","hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","status":"active","version":"8"}} 
[2025-12-02 18:17:41] testing.INFO: Hold validated successfully {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:41] testing.INFO: Hold validation successful {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Creating order in database {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8"} 
[2025-12-02 18:17:41] testing.INFO: Order saved to database {"order_id":4,"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8"} 
[2025-12-02 18:17:41] testing.INFO: Order created successfully {"order_id":4,"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment webhook received {"idempotency_key":"integrity_U5qrhmcL26","order_id":4,"status":"failure"} 
[2025-12-02 18:17:41] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"1508a5a3-c1b4-460a-a964-8b6c99a9dbb8","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:17:41] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:17:41] testing.INFO: Order creation started {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07"} 
[2025-12-02 18:17:41] testing.INFO: Validating hold {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","attempt":1} 
[2025-12-02 18:17:41] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:41.791204Z","expires_at":"2025-12-02T18:19:41.791353Z","expires_at_timestamp":"1764699581","hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","status":"active","version":"10"}} 
[2025-12-02 18:17:41] testing.INFO: Hold validated successfully {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:41] testing.INFO: Hold validation successful {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Creating order in database {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07"} 
[2025-12-02 18:17:41] testing.INFO: Order saved to database {"order_id":5,"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07"} 
[2025-12-02 18:17:41] testing.INFO: Order created successfully {"order_id":5,"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment webhook received {"idempotency_key":"integrity_YHZxtfqgXS","order_id":5,"status":"success"} 
[2025-12-02 18:17:41] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"c15a9845-bb46-43ea-8bfb-4093844d0d07","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 18:17:41] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:42] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 18:17:45] testing.INFO: Cleared all test data  
[2025-12-02 18:17:50] testing.INFO: Cleared all test data  
[2025-12-02 18:17:50] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:17:50] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 18:17:50] testing.INFO: Order creation started {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253"} 
[2025-12-02 18:17:50] testing.INFO: Validating hold {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","attempt":1} 
[2025-12-02 18:17:50] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:17:50.981211Z","expires_at":"2025-12-02T18:19:50.981338Z","expires_at_timestamp":"1764699590","hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","status":"active","version":"2"}} 
[2025-12-02 18:17:50] testing.INFO: Hold validated successfully {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:17:50] testing.INFO: Hold validation successful {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","product_id":1,"quantity":1} 
[2025-12-02 18:17:50] testing.INFO: Creating order in database {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253"} 
[2025-12-02 18:17:51] testing.INFO: Order saved to database {"order_id":1,"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253"} 
[2025-12-02 18:17:51] testing.INFO: Order created successfully {"order_id":1,"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","product_id":1,"quantity":1} 
[2025-12-02 18:17:51] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_OYvzV3iQ6l","order_id":1,"status":"success"} 
[2025-12-02 18:17:51] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"74fd9143-705a-4db0-b876-fd56ac8ec253","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:17:51] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:17:51] testing.INFO: Redis transaction consistency test passed {"order_id":1} 
[2025-12-02 18:17:54] testing.INFO: Cleared all test data  
[2025-12-02 18:18:29] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:18:30] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:18:32] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:18:34] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:18:34] testing.DEBUG: Stock oversell logic test took: 0.01ms  
[2025-12-02 18:18:37] testing.INFO: Cleared all test data  
[2025-12-02 18:18:37] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:37] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 18:18:37] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 18:18:37] testing.INFO: Hold created {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","product_id":1} 
[2025-12-02 18:18:37] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 18:18:37] testing.INFO: Order creation started {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6"} 
[2025-12-02 18:18:37] testing.INFO: Validating hold {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","attempt":1} 
[2025-12-02 18:18:37] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:37.209411Z","expires_at":"2025-12-02T18:20:37.209535Z","expires_at_timestamp":"1764699637","hold_id":"eca35164-da58-494b-89de-21b41c7344a6","status":"active","version":"2"}} 
[2025-12-02 18:18:37] testing.INFO: Hold validated successfully {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:37] testing.INFO: Hold validation successful {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","product_id":1,"quantity":2} 
[2025-12-02 18:18:37] testing.INFO: Creating order in database {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6"} 
[2025-12-02 18:18:37] testing.INFO: Order saved to database {"order_id":1,"hold_id":"eca35164-da58-494b-89de-21b41c7344a6"} 
[2025-12-02 18:18:37] testing.INFO: Order created successfully {"order_id":1,"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","product_id":1,"quantity":2} 
[2025-12-02 18:18:37] testing.INFO: Order created {"order_id":1,"hold_id":"eca35164-da58-494b-89de-21b41c7344a6"} 
[2025-12-02 18:18:37] testing.INFO: Payment webhook received {"idempotency_key":"test_key_OFwt9qwu1h","order_id":1,"status":"success"} 
[2025-12-02 18:18:37] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"eca35164-da58-494b-89de-21b41c7344a6","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:18:37] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:37] testing.INFO: Basic payment flow test passed {"order_id":1,"final_stock":98} 
[2025-12-02 18:18:38] testing.INFO: Cleared all test data  
[2025-12-02 18:18:39] testing.INFO: Cleared all test data  
[2025-12-02 18:18:40] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:40] testing.INFO: === Debug hold creation ===  
[2025-12-02 18:18:40] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 18:18:40] testing.INFO: Hold created successfully {"hold_id":"00c51a3e-68a4-46ab-9123-c319d1384b68","expires_at":"2025-12-02T18:20:40.165668Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 18:18:44] testing.INFO: Cleared all test data  
[2025-12-02 18:18:45] testing.INFO: Cleared all test data  
[2025-12-02 18:18:45] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:45] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 18:18:45] testing.INFO: Order creation started {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af"} 
[2025-12-02 18:18:45] testing.INFO: Validating hold {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","attempt":1} 
[2025-12-02 18:18:45] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:18:45.527075Z","expires_at":"2025-12-02T18:20:45.527207Z","expires_at_timestamp":"1764699645","hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","status":"active","version":"2"}} 
[2025-12-02 18:18:45] testing.INFO: Hold validated successfully {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:18:45] testing.INFO: Hold validation successful {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","product_id":1,"quantity":1} 
[2025-12-02 18:18:45] testing.INFO: Creating order in database {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af"} 
[2025-12-02 18:18:45] testing.INFO: Order saved to database {"order_id":1,"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af"} 
[2025-12-02 18:18:45] testing.INFO: Order created successfully {"order_id":1,"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","product_id":1,"quantity":1} 
[2025-12-02 18:18:45] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_OpCbQ9Jc89","order_id":1,"status":"success"} 
[2025-12-02 18:18:45] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"10a729ac-d0a3-4868-92a5-4b16dee830af","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:18:45] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:45] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_OpCbQ9Jc89","order_id":1,"status":"success"} 
[2025-12-02 18:18:45] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 18:18:45] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_OpCbQ9Jc89"} 
[2025-12-02 18:18:47] testing.INFO: Cleared all test data  
[2025-12-02 18:18:48] testing.INFO: Cleared all test data  
[2025-12-02 18:18:48] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:48] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 18:18:48] testing.INFO: Order creation started {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066"} 
[2025-12-02 18:18:48] testing.INFO: Validating hold {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","attempt":1} 
[2025-12-02 18:18:48] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T18:18:48.547452Z","expires_at":"2025-12-02T18:20:48.547580Z","expires_at_timestamp":"1764699648","hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","status":"active","version":"2"}} 
[2025-12-02 18:18:48] testing.INFO: Hold validated successfully {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 18:18:48] testing.INFO: Hold validation successful {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","product_id":1,"quantity":3} 
[2025-12-02 18:18:48] testing.INFO: Creating order in database {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066"} 
[2025-12-02 18:18:48] testing.INFO: Order saved to database {"order_id":1,"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066"} 
[2025-12-02 18:18:48] testing.INFO: Order created successfully {"order_id":1,"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","product_id":1,"quantity":3} 
[2025-12-02 18:18:48] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_dk8zoQ6ISG","order_id":1,"status":"failure"} 
[2025-12-02 18:18:48] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"9abb5d2a-622c-4000-9b85-db1becad2066","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 18:18:48] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:18:48] testing.INFO: Failed payment flow test passed {"order_id":1,"stock_restored":true} 
[2025-12-02 18:18:50] testing.INFO: Cleared all test data  
[2025-12-02 18:18:53] testing.INFO: Cleared all test data  
[2025-12-02 18:18:54] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:54] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 18:18:54] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold created {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold created {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold created {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold created {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold created {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 18:18:54] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 18:18:54] testing.INFO: Order creation started {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11"} 
[2025-12-02 18:18:54] testing.INFO: Validating hold {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","attempt":1} 
[2025-12-02 18:18:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:54.260808Z","expires_at":"2025-12-02T18:20:54.260933Z","expires_at_timestamp":"1764699654","hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","status":"active","version":"2"}} 
[2025-12-02 18:18:54] testing.INFO: Hold validated successfully {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:54] testing.INFO: Hold validation successful {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Creating order in database {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11"} 
[2025-12-02 18:18:54] testing.INFO: Order saved to database {"order_id":1,"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11"} 
[2025-12-02 18:18:54] testing.INFO: Order created successfully {"order_id":1,"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Order created {"order_id":1,"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Order creation started {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942"} 
[2025-12-02 18:18:54] testing.INFO: Validating hold {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","attempt":1} 
[2025-12-02 18:18:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:54.263844Z","expires_at":"2025-12-02T18:20:54.263960Z","expires_at_timestamp":"1764699654","hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","status":"active","version":"3"}} 
[2025-12-02 18:18:54] testing.INFO: Hold validated successfully {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:54] testing.INFO: Hold validation successful {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Creating order in database {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942"} 
[2025-12-02 18:18:54] testing.INFO: Order saved to database {"order_id":2,"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942"} 
[2025-12-02 18:18:54] testing.INFO: Order created successfully {"order_id":2,"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Order created {"order_id":2,"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Order creation started {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef"} 
[2025-12-02 18:18:54] testing.INFO: Validating hold {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","attempt":1} 
[2025-12-02 18:18:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:54.266888Z","expires_at":"2025-12-02T18:20:54.267002Z","expires_at_timestamp":"1764699654","hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","status":"active","version":"4"}} 
[2025-12-02 18:18:54] testing.INFO: Hold validated successfully {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:54] testing.INFO: Hold validation successful {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Creating order in database {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef"} 
[2025-12-02 18:18:54] testing.INFO: Order saved to database {"order_id":3,"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef"} 
[2025-12-02 18:18:54] testing.INFO: Order created successfully {"order_id":3,"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Order created {"order_id":3,"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Order creation started {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f"} 
[2025-12-02 18:18:54] testing.INFO: Validating hold {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","attempt":1} 
[2025-12-02 18:18:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:54.269604Z","expires_at":"2025-12-02T18:20:54.269718Z","expires_at_timestamp":"1764699654","hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","status":"active","version":"5"}} 
[2025-12-02 18:18:54] testing.INFO: Hold validated successfully {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:54] testing.INFO: Hold validation successful {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Creating order in database {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f"} 
[2025-12-02 18:18:54] testing.INFO: Order saved to database {"order_id":4,"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f"} 
[2025-12-02 18:18:54] testing.INFO: Order created successfully {"order_id":4,"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Order created {"order_id":4,"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Order creation started {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf"} 
[2025-12-02 18:18:54] testing.INFO: Validating hold {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","attempt":1} 
[2025-12-02 18:18:54] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:18:54.272188Z","expires_at":"2025-12-02T18:20:54.272311Z","expires_at_timestamp":"1764699654","hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","status":"active","version":"6"}} 
[2025-12-02 18:18:54] testing.INFO: Hold validated successfully {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:18:54] testing.INFO: Hold validation successful {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Creating order in database {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf"} 
[2025-12-02 18:18:54] testing.INFO: Order saved to database {"order_id":5,"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf"} 
[2025-12-02 18:18:54] testing.INFO: Order created successfully {"order_id":5,"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Order created {"order_id":5,"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 18:18:54] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_kSmVxhJXqj","order_id":1,"status":"success"} 
[2025-12-02 18:18:54] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:54] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 18:18:54] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_bXftoHxG31","order_id":2,"status":"success"} 
[2025-12-02 18:18:54] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:54] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 18:18:54] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_L5rNGCJzII","order_id":3,"status":"success"} 
[2025-12-02 18:18:54] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:54] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 18:18:54] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_xudVAwDYOE","order_id":4,"status":"success"} 
[2025-12-02 18:18:54] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:54] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 18:18:54] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_8j48Ayalp8","order_id":5,"status":"success"} 
[2025-12-02 18:18:54] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 18:18:54] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:54] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 18:18:54] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 18:18:54] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11"} 
[2025-12-02 18:18:54] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942"} 
[2025-12-02 18:18:54] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef"} 
[2025-12-02 18:18:54] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f"} 
[2025-12-02 18:18:54] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf"} 
[2025-12-02 18:18:54] testing.DEBUG: Hold state {"hold_id":"36d06134-a769-4bc7-8d9a-ddca547a3f11","status":"unknown","quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Hold state {"hold_id":"57d0ac15-c641-4f09-bb92-d747b3d1b942","status":"unknown","quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Hold state {"hold_id":"840b13fd-98a7-4e1e-ab06-77422fc5bdef","status":"unknown","quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Hold state {"hold_id":"692b9f49-9e97-45af-b292-bf61767fa65f","status":"unknown","quantity":2} 
[2025-12-02 18:18:54] testing.DEBUG: Hold state {"hold_id":"96f9830d-853b-4f98-a8c9-13f1a8337ddf","status":"unknown","quantity":2} 
[2025-12-02 18:18:54] testing.INFO: High concurrency flash sale test completed {"database_stock":90,"redis_available":90,"redis_reserved":0,"stock_difference":0,"test_passed":true} 
[2025-12-02 18:18:56] testing.INFO: Cleared all test data  
[2025-12-02 18:18:57] testing.INFO: Cleared all test data  
[2025-12-02 18:18:57] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:18:57] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 18:18:57] testing.INFO: Order creation started {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d"} 
[2025-12-02 18:18:57] testing.INFO: Validating hold {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","attempt":1} 
[2025-12-02 18:18:57] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:18:57.551219Z","expires_at":"2025-12-02T18:20:57.551360Z","expires_at_timestamp":"1764699657","hold_id":"e6937394-2963-4575-9ba1-186e845b565d","status":"active","version":"2"}} 
[2025-12-02 18:18:57] testing.INFO: Hold validated successfully {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:18:57] testing.INFO: Hold validation successful {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","product_id":1,"quantity":1} 
[2025-12-02 18:18:57] testing.INFO: Creating order in database {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d"} 
[2025-12-02 18:18:57] testing.INFO: Order saved to database {"order_id":1,"hold_id":"e6937394-2963-4575-9ba1-186e845b565d"} 
[2025-12-02 18:18:57] testing.INFO: Order created successfully {"order_id":1,"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","product_id":1,"quantity":1} 
[2025-12-02 18:18:57] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_ZhndgZyZA8","order_id":999999,"status":"success"} 
[2025-12-02 18:18:57] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_ZhndgZyZA8","order_id":999999,"status":"success"} 
[2025-12-02 18:18:57] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_ZhndgZyZA8","order_id":1,"status":"success"} 
[2025-12-02 18:18:57] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"e6937394-2963-4575-9ba1-186e845b565d","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:18:57] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:18:57] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 18:18:59] testing.INFO: Cleared all test data  
[2025-12-02 18:19:03] testing.INFO: Cleared all test data  
[2025-12-02 18:19:03] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:19:03] testing.INFO: === Starting data integrity test ===  
[2025-12-02 18:19:03] testing.INFO: Order creation started {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28"} 
[2025-12-02 18:19:03] testing.INFO: Validating hold {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","attempt":1} 
[2025-12-02 18:19:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:03.461958Z","expires_at":"2025-12-02T18:21:03.462092Z","expires_at_timestamp":"1764699663","hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","status":"active","version":"2"}} 
[2025-12-02 18:19:03] testing.INFO: Hold validated successfully {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:03] testing.INFO: Hold validation successful {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Creating order in database {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28"} 
[2025-12-02 18:19:03] testing.INFO: Order saved to database {"order_id":1,"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28"} 
[2025-12-02 18:19:03] testing.INFO: Order created successfully {"order_id":1,"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment webhook received {"idempotency_key":"integrity_0EhtHrxfF3","order_id":1,"status":"success"} 
[2025-12-02 18:19:03] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"39759653-5b4b-4b06-8b43-da7e8ee3af28","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:19:03] testing.INFO: Order creation started {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8"} 
[2025-12-02 18:19:03] testing.INFO: Validating hold {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","attempt":1} 
[2025-12-02 18:19:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:03.647024Z","expires_at":"2025-12-02T18:21:03.647150Z","expires_at_timestamp":"1764699663","hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","status":"active","version":"4"}} 
[2025-12-02 18:19:03] testing.INFO: Hold validated successfully {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:03] testing.INFO: Hold validation successful {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Creating order in database {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8"} 
[2025-12-02 18:19:03] testing.INFO: Order saved to database {"order_id":2,"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8"} 
[2025-12-02 18:19:03] testing.INFO: Order created successfully {"order_id":2,"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment webhook received {"idempotency_key":"integrity_eSHFN1gbnC","order_id":2,"status":"failure"} 
[2025-12-02 18:19:03] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"19af177d-b977-4af0-98c8-d2e8b83bbad8","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:19:03] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:19:03] testing.INFO: Order creation started {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555"} 
[2025-12-02 18:19:03] testing.INFO: Validating hold {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","attempt":1} 
[2025-12-02 18:19:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:03.737458Z","expires_at":"2025-12-02T18:21:03.737583Z","expires_at_timestamp":"1764699663","hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","status":"active","version":"6"}} 
[2025-12-02 18:19:03] testing.INFO: Hold validated successfully {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:03] testing.INFO: Hold validation successful {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Creating order in database {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555"} 
[2025-12-02 18:19:03] testing.INFO: Order saved to database {"order_id":3,"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555"} 
[2025-12-02 18:19:03] testing.INFO: Order created successfully {"order_id":3,"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment webhook received {"idempotency_key":"integrity_jpmfz1nGca","order_id":3,"status":"success"} 
[2025-12-02 18:19:03] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"9675a715-1166-4b16-8baa-4bc345d39555","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:19:03] testing.INFO: Order creation started {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4"} 
[2025-12-02 18:19:03] testing.INFO: Validating hold {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","attempt":1} 
[2025-12-02 18:19:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:03.896311Z","expires_at":"2025-12-02T18:21:03.896442Z","expires_at_timestamp":"1764699663","hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","status":"active","version":"8"}} 
[2025-12-02 18:19:03] testing.INFO: Hold validated successfully {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:03] testing.INFO: Hold validation successful {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Creating order in database {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4"} 
[2025-12-02 18:19:03] testing.INFO: Order saved to database {"order_id":4,"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4"} 
[2025-12-02 18:19:03] testing.INFO: Order created successfully {"order_id":4,"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Payment webhook received {"idempotency_key":"integrity_nxf3XxOzpN","order_id":4,"status":"failure"} 
[2025-12-02 18:19:03] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"30aea081-2e84-4347-a18b-909e9901d3c4","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:19:03] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:19:03] testing.INFO: Order creation started {"hold_id":"b58447de-b786-4062-bccc-78df5913039b"} 
[2025-12-02 18:19:03] testing.INFO: Validating hold {"hold_id":"b58447de-b786-4062-bccc-78df5913039b","attempt":1} 
[2025-12-02 18:19:03] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"b58447de-b786-4062-bccc-78df5913039b","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:03.975528Z","expires_at":"2025-12-02T18:21:03.975653Z","expires_at_timestamp":"1764699663","hold_id":"b58447de-b786-4062-bccc-78df5913039b","status":"active","version":"10"}} 
[2025-12-02 18:19:03] testing.INFO: Hold validated successfully {"hold_id":"b58447de-b786-4062-bccc-78df5913039b","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:03] testing.INFO: Hold validation successful {"hold_id":"b58447de-b786-4062-bccc-78df5913039b","product_id":1,"quantity":1} 
[2025-12-02 18:19:03] testing.INFO: Creating order in database {"hold_id":"b58447de-b786-4062-bccc-78df5913039b"} 
[2025-12-02 18:19:03] testing.INFO: Order saved to database {"order_id":5,"hold_id":"b58447de-b786-4062-bccc-78df5913039b"} 
[2025-12-02 18:19:04] testing.INFO: Order created successfully {"order_id":5,"hold_id":"b58447de-b786-4062-bccc-78df5913039b","product_id":1,"quantity":1} 
[2025-12-02 18:19:04] testing.INFO: Payment webhook received {"idempotency_key":"integrity_osIp5fqE0r","order_id":5,"status":"success"} 
[2025-12-02 18:19:04] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"b58447de-b786-4062-bccc-78df5913039b","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 18:19:04] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:19:04] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 18:19:05] testing.INFO: Cleared all test data  
[2025-12-02 18:19:06] testing.INFO: Cleared all test data  
[2025-12-02 18:19:06] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:19:07] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 18:19:07] testing.INFO: Order creation started {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884"} 
[2025-12-02 18:19:07] testing.INFO: Validating hold {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","attempt":1} 
[2025-12-02 18:19:07] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:19:07.058938Z","expires_at":"2025-12-02T18:21:07.059062Z","expires_at_timestamp":"1764699667","hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","status":"active","version":"2"}} 
[2025-12-02 18:19:07] testing.INFO: Hold validated successfully {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:19:07] testing.INFO: Hold validation successful {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","product_id":1,"quantity":1} 
[2025-12-02 18:19:07] testing.INFO: Creating order in database {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884"} 
[2025-12-02 18:19:07] testing.INFO: Order saved to database {"order_id":1,"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884"} 
[2025-12-02 18:19:07] testing.INFO: Order created successfully {"order_id":1,"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","product_id":1,"quantity":1} 
[2025-12-02 18:19:07] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_BjuPxAsWvR","order_id":1,"status":"success"} 
[2025-12-02 18:19:07] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"0d3b03ff-3967-4f4b-a076-18db515d2884","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:19:07] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:19:07] testing.INFO: Redis transaction consistency test passed {"order_id":1} 
[2025-12-02 18:19:08] testing.INFO: Cleared all test data  
[2025-12-02 18:23:10] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:23:11] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:23:12] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:23:14] testing.INFO: Expired holds processing completed {"processed_count":0,"expired_count":0,"error_count":0,"execution_time":0.0} 
[2025-12-02 18:23:14] testing.DEBUG: Stock oversell logic test took: 0.01ms  
[2025-12-02 18:23:21] testing.INFO: Cleared all test data  
[2025-12-02 18:23:21] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:23:21] testing.INFO: === Starting basic payment flow test ===  
[2025-12-02 18:23:21] testing.DEBUG: Redis state {"available":"100","reserved":"0","version":"1","available_type":"string","available_int":100} 
[2025-12-02 18:23:21] testing.INFO: Hold created {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","product_id":1} 
[2025-12-02 18:23:21] testing.DEBUG: Redis after hold {"available":"98"} 
[2025-12-02 18:23:21] testing.INFO: Order creation started {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a"} 
[2025-12-02 18:23:21] testing.INFO: Validating hold {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","attempt":1} 
[2025-12-02 18:23:21] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:21.417316Z","expires_at":"2025-12-02T18:25:21.417440Z","expires_at_timestamp":"1764699921","hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","status":"active","version":"2"}} 
[2025-12-02 18:23:21] testing.INFO: Hold validated successfully {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:21] testing.INFO: Hold validation successful {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","product_id":1,"quantity":2} 
[2025-12-02 18:23:21] testing.INFO: Creating order in database {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a"} 
[2025-12-02 18:23:21] testing.INFO: Order saved to database {"order_id":1,"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a"} 
[2025-12-02 18:23:21] testing.INFO: Order created successfully {"order_id":1,"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","product_id":1,"quantity":2} 
[2025-12-02 18:23:21] testing.INFO: Order created {"order_id":1,"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a"} 
[2025-12-02 18:23:21] testing.INFO: Payment webhook received {"idempotency_key":"test_key_3Q2v5t8P9N","order_id":1,"status":"success"} 
[2025-12-02 18:23:21] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"ca441540-8f01-4ab3-9408-b64edfd2551a","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:23:21] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:21] testing.INFO: Basic payment flow test passed {"order_id":1,"final_stock":98} 
[2025-12-02 18:23:24] testing.INFO: Cleared all test data  
[2025-12-02 18:23:27] testing.INFO: Cleared all test data  
[2025-12-02 18:23:27] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:23:27] testing.INFO: === Debug hold creation ===  
[2025-12-02 18:23:27] testing.INFO: Redis before hold creation {"available":"100","reserved":"0","version":"1","available_int":100} 
[2025-12-02 18:23:27] testing.INFO: Hold created successfully {"hold_id":"7ba5727b-f905-412d-b2fe-ef025e75c656","expires_at":"2025-12-02T18:25:27.351978Z","product_id":1,"quantity":1,"available_stock":99,"reserved_stock":1,"version":"2"} 
[2025-12-02 18:23:32] testing.INFO: Cleared all test data  
[2025-12-02 18:23:36] testing.INFO: Cleared all test data  
[2025-12-02 18:23:36] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:23:36] testing.INFO: === Starting payment idempotency test ===  
[2025-12-02 18:23:36] testing.INFO: Order creation started {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843"} 
[2025-12-02 18:23:36] testing.INFO: Validating hold {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","attempt":1} 
[2025-12-02 18:23:36] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:23:36.762020Z","expires_at":"2025-12-02T18:25:36.762150Z","expires_at_timestamp":"1764699936","hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","status":"active","version":"2"}} 
[2025-12-02 18:23:36] testing.INFO: Hold validated successfully {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:23:36] testing.INFO: Hold validation successful {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","product_id":1,"quantity":1} 
[2025-12-02 18:23:36] testing.INFO: Creating order in database {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843"} 
[2025-12-02 18:23:36] testing.INFO: Order saved to database {"order_id":1,"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843"} 
[2025-12-02 18:23:36] testing.INFO: Order created successfully {"order_id":1,"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","product_id":1,"quantity":1} 
[2025-12-02 18:23:36] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_mT12Jvzc6B","order_id":1,"status":"success"} 
[2025-12-02 18:23:36] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"36f1c145-9f6b-4a97-a264-07c0afd84843","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:23:36] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:36] testing.INFO: Payment webhook received {"idempotency_key":"idempotent_key_mT12Jvzc6B","order_id":1,"status":"success"} 
[2025-12-02 18:23:36] testing.WARNING: Order already finalized {"order_id":1,"current_state":"paid","webhook_status":"success"} 
[2025-12-02 18:23:36] testing.INFO: Payment idempotency test passed {"order_id":1,"idempotency_key":"idempotent_key_mT12Jvzc6B"} 
[2025-12-02 18:23:40] testing.INFO: Cleared all test data  
[2025-12-02 18:23:43] testing.INFO: Cleared all test data  
[2025-12-02 18:23:43] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:23:44] testing.INFO: === Starting failed payment flow test ===  
[2025-12-02 18:23:44] testing.INFO: Order creation started {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687"} 
[2025-12-02 18:23:44] testing.INFO: Validating hold {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","attempt":1} 
[2025-12-02 18:23:44] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","hold_data":{"product_id":"1","qty":"3","created_at":"2025-12-02T18:23:44.066112Z","expires_at":"2025-12-02T18:25:44.066234Z","expires_at_timestamp":"1764699944","hold_id":"012739da-d506-4078-8e0b-bb74fab98687","status":"active","version":"2"}} 
[2025-12-02 18:23:44] testing.INFO: Hold validated successfully {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","product_id":1,"quantity":3,"status":"active"} 
[2025-12-02 18:23:44] testing.INFO: Hold validation successful {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","product_id":1,"quantity":3} 
[2025-12-02 18:23:44] testing.INFO: Creating order in database {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687"} 
[2025-12-02 18:23:44] testing.INFO: Order saved to database {"order_id":1,"hold_id":"012739da-d506-4078-8e0b-bb74fab98687"} 
[2025-12-02 18:23:44] testing.INFO: Order created successfully {"order_id":1,"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","product_id":1,"quantity":3} 
[2025-12-02 18:23:44] testing.INFO: Payment webhook received {"idempotency_key":"fail_key_78zxQX5mRF","order_id":1,"status":"failure"} 
[2025-12-02 18:23:44] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"012739da-d506-4078-8e0b-bb74fab98687","order_id":1,"product_id":1,"quantity_restored":3} 
[2025-12-02 18:23:44] testing.INFO: Payment failed - stock restored {"order_id":1,"product_id":1,"quantity_restored":3,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:23:44] testing.INFO: Failed payment flow test passed {"order_id":1,"stock_restored":true} 
[2025-12-02 18:23:48] testing.INFO: Cleared all test data  
[2025-12-02 18:23:51] testing.INFO: Cleared all test data  
[2025-12-02 18:23:51] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:23:51] testing.INFO: === Starting high concurrency flash sale test ===  
[2025-12-02 18:23:51] testing.DEBUG: Initial state {"database_stock":100,"redis_available":"100","redis_reserved":"0"} 
[2025-12-02 18:23:51] testing.DEBUG: Hold created {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","quantity":2,"total_created":2,"redis_available":"98","redis_reserved":"2"} 
[2025-12-02 18:23:52] testing.DEBUG: Hold created {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","quantity":2,"total_created":4,"redis_available":"96","redis_reserved":"4"} 
[2025-12-02 18:23:52] testing.DEBUG: Hold created {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","quantity":2,"total_created":6,"redis_available":"94","redis_reserved":"6"} 
[2025-12-02 18:23:52] testing.DEBUG: Hold created {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","quantity":2,"total_created":8,"redis_available":"92","redis_reserved":"8"} 
[2025-12-02 18:23:52] testing.DEBUG: Hold created {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","quantity":2,"total_created":10,"redis_available":"90","redis_reserved":"10"} 
[2025-12-02 18:23:52] testing.INFO: Holds created for flash sale {"holds_count":5,"total_quantity":10,"failed_holds":0,"redis_after_holds":{"available":"90","reserved":"10"}} 
[2025-12-02 18:23:52] testing.INFO: Order creation started {"hold_id":"f5653799-d359-401c-ad63-165825678fe8"} 
[2025-12-02 18:23:52] testing.INFO: Validating hold {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","attempt":1} 
[2025-12-02 18:23:52] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:51.995557Z","expires_at":"2025-12-02T18:25:51.995682Z","expires_at_timestamp":"1764699951","hold_id":"f5653799-d359-401c-ad63-165825678fe8","status":"active","version":"2"}} 
[2025-12-02 18:23:52] testing.INFO: Hold validated successfully {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:52] testing.INFO: Hold validation successful {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Creating order in database {"hold_id":"f5653799-d359-401c-ad63-165825678fe8"} 
[2025-12-02 18:23:52] testing.INFO: Order saved to database {"order_id":1,"hold_id":"f5653799-d359-401c-ad63-165825678fe8"} 
[2025-12-02 18:23:52] testing.INFO: Order created successfully {"order_id":1,"hold_id":"f5653799-d359-401c-ad63-165825678fe8","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.DEBUG: Order created {"order_id":1,"hold_id":"f5653799-d359-401c-ad63-165825678fe8","quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Order creation started {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e"} 
[2025-12-02 18:23:52] testing.INFO: Validating hold {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","attempt":1} 
[2025-12-02 18:23:52] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:51.998160Z","expires_at":"2025-12-02T18:25:51.998282Z","expires_at_timestamp":"1764699951","hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","status":"active","version":"3"}} 
[2025-12-02 18:23:52] testing.INFO: Hold validated successfully {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:52] testing.INFO: Hold validation successful {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Creating order in database {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e"} 
[2025-12-02 18:23:52] testing.INFO: Order saved to database {"order_id":2,"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e"} 
[2025-12-02 18:23:52] testing.INFO: Order created successfully {"order_id":2,"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.DEBUG: Order created {"order_id":2,"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Order creation started {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354"} 
[2025-12-02 18:23:52] testing.INFO: Validating hold {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","attempt":1} 
[2025-12-02 18:23:52] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:52.001944Z","expires_at":"2025-12-02T18:25:52.002166Z","expires_at_timestamp":"1764699952","hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","status":"active","version":"4"}} 
[2025-12-02 18:23:52] testing.INFO: Hold validated successfully {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:52] testing.INFO: Hold validation successful {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Creating order in database {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354"} 
[2025-12-02 18:23:52] testing.INFO: Order saved to database {"order_id":3,"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354"} 
[2025-12-02 18:23:52] testing.INFO: Order created successfully {"order_id":3,"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.DEBUG: Order created {"order_id":3,"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Order creation started {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767"} 
[2025-12-02 18:23:52] testing.INFO: Validating hold {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","attempt":1} 
[2025-12-02 18:23:52] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:52.005606Z","expires_at":"2025-12-02T18:25:52.005724Z","expires_at_timestamp":"1764699952","hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","status":"active","version":"5"}} 
[2025-12-02 18:23:52] testing.INFO: Hold validated successfully {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:52] testing.INFO: Hold validation successful {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Creating order in database {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767"} 
[2025-12-02 18:23:52] testing.INFO: Order saved to database {"order_id":4,"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767"} 
[2025-12-02 18:23:52] testing.INFO: Order created successfully {"order_id":4,"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.DEBUG: Order created {"order_id":4,"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Order creation started {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0"} 
[2025-12-02 18:23:52] testing.INFO: Validating hold {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","attempt":1} 
[2025-12-02 18:23:52] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","hold_data":{"product_id":"1","qty":"2","created_at":"2025-12-02T18:23:52.009015Z","expires_at":"2025-12-02T18:25:52.009114Z","expires_at_timestamp":"1764699952","hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","status":"active","version":"6"}} 
[2025-12-02 18:23:52] testing.INFO: Hold validated successfully {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","product_id":1,"quantity":2,"status":"active"} 
[2025-12-02 18:23:52] testing.INFO: Hold validation successful {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Creating order in database {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0"} 
[2025-12-02 18:23:52] testing.INFO: Order saved to database {"order_id":5,"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0"} 
[2025-12-02 18:23:52] testing.INFO: Order created successfully {"order_id":5,"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.DEBUG: Order created {"order_id":5,"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Orders created {"orders_count":5,"failed_orders":0,"redis_after_orders":{"available":"90","reserved":"10"}} 
[2025-12-02 18:23:52] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_7Vlo0Q4NIP","order_id":1,"status":"success"} 
[2025-12-02 18:23:52] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","order_id":1,"product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:52] testing.DEBUG: Payment processed {"order_id":1,"success":true,"status":200,"redis_available":"90","redis_reserved":"8"} 
[2025-12-02 18:23:52] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_arf7e88XnL","order_id":2,"status":"success"} 
[2025-12-02 18:23:52] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","order_id":2,"product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Payment succeeded {"order_id":2,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:52] testing.DEBUG: Payment processed {"order_id":2,"success":true,"status":200,"redis_available":"90","redis_reserved":"6"} 
[2025-12-02 18:23:52] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_P6HpRWJgue","order_id":3,"status":"success"} 
[2025-12-02 18:23:52] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","order_id":3,"product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:52] testing.DEBUG: Payment processed {"order_id":3,"success":true,"status":200,"redis_available":"90","redis_reserved":"4"} 
[2025-12-02 18:23:52] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_XvvUr0E4Ge","order_id":4,"status":"success"} 
[2025-12-02 18:23:52] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","order_id":4,"product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Payment succeeded {"order_id":4,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:52] testing.DEBUG: Payment processed {"order_id":4,"success":true,"status":200,"redis_available":"90","redis_reserved":"2"} 
[2025-12-02 18:23:52] testing.INFO: Payment webhook received {"idempotency_key":"flash_sale_8uJMujEu0k","order_id":5,"status":"success"} 
[2025-12-02 18:23:52] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","order_id":5,"product_id":1,"quantity":2} 
[2025-12-02 18:23:52] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":2,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:23:53] testing.DEBUG: Payment processed {"order_id":5,"success":true,"status":200,"redis_available":"90","redis_reserved":"0"} 
[2025-12-02 18:23:53] testing.INFO: Flash sale test analysis {"initial_stock":100,"total_holds_quantity":10,"successful_payments":5,"failed_payments":0,"total_processed_quantity":10,"total_failed_quantity":0,"database_stock":90,"redis_available":90,"redis_reserved":0,"expected_database_stock":90,"expected_redis_available":90,"calculated_redis_available":90,"paid_orders_count":5,"cancelled_orders_count":0,"pending_orders_count":0,"results_summary":{"Illuminate\\Support\\Collection":{"1":{"count":5,"total_quantity":10}}}} 
[2025-12-02 18:23:53] testing.DEBUG: Order state {"order_id":1,"state":"paid","hold_id":"f5653799-d359-401c-ad63-165825678fe8"} 
[2025-12-02 18:23:53] testing.DEBUG: Order state {"order_id":2,"state":"paid","hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e"} 
[2025-12-02 18:23:53] testing.DEBUG: Order state {"order_id":3,"state":"paid","hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354"} 
[2025-12-02 18:23:53] testing.DEBUG: Order state {"order_id":4,"state":"paid","hold_id":"9d277074-2b27-439c-9939-02d2ead7b767"} 
[2025-12-02 18:23:53] testing.DEBUG: Order state {"order_id":5,"state":"paid","hold_id":"476e0439-6b77-4d2d-a972-a139afababc0"} 
[2025-12-02 18:23:53] testing.DEBUG: Hold state {"hold_id":"f5653799-d359-401c-ad63-165825678fe8","status":"unknown","quantity":2} 
[2025-12-02 18:23:53] testing.DEBUG: Hold state {"hold_id":"c232b100-9d98-43d2-b6b6-ecfd6f90748e","status":"unknown","quantity":2} 
[2025-12-02 18:23:53] testing.DEBUG: Hold state {"hold_id":"cf52a118-85d7-4e65-a44c-4efdceb65354","status":"unknown","quantity":2} 
[2025-12-02 18:23:53] testing.DEBUG: Hold state {"hold_id":"9d277074-2b27-439c-9939-02d2ead7b767","status":"unknown","quantity":2} 
[2025-12-02 18:23:53] testing.DEBUG: Hold state {"hold_id":"476e0439-6b77-4d2d-a972-a139afababc0","status":"unknown","quantity":2} 
[2025-12-02 18:23:53] testing.INFO: High concurrency flash sale test completed {"database_stock":90,"redis_available":90,"redis_reserved":0,"stock_difference":0,"test_passed":true} 
[2025-12-02 18:23:58] testing.INFO: Cleared all test data  
[2025-12-02 18:24:01] testing.INFO: Cleared all test data  
[2025-12-02 18:24:02] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:24:02] testing.INFO: === Starting out-of-order webhook test ===  
[2025-12-02 18:24:02] testing.INFO: Order creation started {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600"} 
[2025-12-02 18:24:02] testing.INFO: Validating hold {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","attempt":1} 
[2025-12-02 18:24:02] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:02.136968Z","expires_at":"2025-12-02T18:26:02.137092Z","expires_at_timestamp":"1764699962","hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","status":"active","version":"2"}} 
[2025-12-02 18:24:02] testing.INFO: Hold validated successfully {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:02] testing.INFO: Hold validation successful {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","product_id":1,"quantity":1} 
[2025-12-02 18:24:02] testing.INFO: Creating order in database {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600"} 
[2025-12-02 18:24:02] testing.INFO: Order saved to database {"order_id":1,"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600"} 
[2025-12-02 18:24:02] testing.INFO: Order created successfully {"order_id":1,"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","product_id":1,"quantity":1} 
[2025-12-02 18:24:02] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_DY1dzSkrlG","order_id":999999,"status":"success"} 
[2025-12-02 18:24:02] testing.WARNING: Order not found for webhook {"idempotency_key":"out_of_order_DY1dzSkrlG","order_id":999999,"status":"success"} 
[2025-12-02 18:24:02] testing.INFO: Payment webhook received {"idempotency_key":"out_of_order_DY1dzSkrlG","order_id":1,"status":"success"} 
[2025-12-02 18:24:02] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"a74df064-ad58-4186-8be3-1b27d0c74600","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:24:02] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:24:02] testing.INFO: Out-of-order webhook test passed {"order_id":1} 
[2025-12-02 18:24:05] testing.INFO: Cleared all test data  
[2025-12-02 18:24:10] testing.INFO: Cleared all test data  
[2025-12-02 18:24:10] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:24:10] testing.INFO: === Starting data integrity test ===  
[2025-12-02 18:24:10] testing.INFO: Order creation started {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895"} 
[2025-12-02 18:24:10] testing.INFO: Validating hold {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","attempt":1} 
[2025-12-02 18:24:10] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:10.977496Z","expires_at":"2025-12-02T18:26:10.977692Z","expires_at_timestamp":"1764699970","hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","status":"active","version":"2"}} 
[2025-12-02 18:24:10] testing.INFO: Hold validated successfully {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:10] testing.INFO: Hold validation successful {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","product_id":1,"quantity":1} 
[2025-12-02 18:24:10] testing.INFO: Creating order in database {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895"} 
[2025-12-02 18:24:10] testing.INFO: Order saved to database {"order_id":1,"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895"} 
[2025-12-02 18:24:11] testing.INFO: Order created successfully {"order_id":1,"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Payment webhook received {"idempotency_key":"integrity_mILw6k5IVX","order_id":1,"status":"success"} 
[2025-12-02 18:24:11] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"166e99b5-eeda-4caa-bc67-24cf177e2895","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:24:11] testing.INFO: Order creation started {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced"} 
[2025-12-02 18:24:11] testing.INFO: Validating hold {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","attempt":1} 
[2025-12-02 18:24:11] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:11.518059Z","expires_at":"2025-12-02T18:26:11.518185Z","expires_at_timestamp":"1764699971","hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","status":"active","version":"4"}} 
[2025-12-02 18:24:11] testing.INFO: Hold validated successfully {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:11] testing.INFO: Hold validation successful {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Creating order in database {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced"} 
[2025-12-02 18:24:11] testing.INFO: Order saved to database {"order_id":2,"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced"} 
[2025-12-02 18:24:11] testing.INFO: Order created successfully {"order_id":2,"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Payment webhook received {"idempotency_key":"integrity_7XbFJuwxzR","order_id":2,"status":"failure"} 
[2025-12-02 18:24:11] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"69b62ad4-4b81-4884-adce-6378b0d45ced","order_id":2,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:24:11] testing.INFO: Payment failed - stock restored {"order_id":2,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:24:11] testing.INFO: Order creation started {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c"} 
[2025-12-02 18:24:11] testing.INFO: Validating hold {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","attempt":1} 
[2025-12-02 18:24:11] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:11.716943Z","expires_at":"2025-12-02T18:26:11.717074Z","expires_at_timestamp":"1764699971","hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","status":"active","version":"6"}} 
[2025-12-02 18:24:11] testing.INFO: Hold validated successfully {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:11] testing.INFO: Hold validation successful {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Creating order in database {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c"} 
[2025-12-02 18:24:11] testing.INFO: Order saved to database {"order_id":3,"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c"} 
[2025-12-02 18:24:11] testing.INFO: Order created successfully {"order_id":3,"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Payment webhook received {"idempotency_key":"integrity_alFtCFkYwJ","order_id":3,"status":"success"} 
[2025-12-02 18:24:11] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"aa88b686-91ae-4dc0-b14c-728c8035bf1c","order_id":3,"product_id":1,"quantity":1} 
[2025-12-02 18:24:11] testing.INFO: Payment succeeded {"order_id":3,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:24:12] testing.INFO: Order creation started {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65"} 
[2025-12-02 18:24:12] testing.INFO: Validating hold {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","attempt":1} 
[2025-12-02 18:24:12] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:12.005747Z","expires_at":"2025-12-02T18:26:12.005883Z","expires_at_timestamp":"1764699972","hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","status":"active","version":"8"}} 
[2025-12-02 18:24:12] testing.INFO: Hold validated successfully {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:12] testing.INFO: Hold validation successful {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","product_id":1,"quantity":1} 
[2025-12-02 18:24:12] testing.INFO: Creating order in database {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65"} 
[2025-12-02 18:24:12] testing.INFO: Order saved to database {"order_id":4,"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65"} 
[2025-12-02 18:24:12] testing.INFO: Order created successfully {"order_id":4,"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","product_id":1,"quantity":1} 
[2025-12-02 18:24:12] testing.INFO: Payment webhook received {"idempotency_key":"integrity_G2gQ7qyvKM","order_id":4,"status":"failure"} 
[2025-12-02 18:24:12] testing.DEBUG: Payment failure processed in Redis - hold deleted {"hold_id":"4460933b-7143-489a-97f7-f05386b8ff65","order_id":4,"product_id":1,"quantity_restored":1} 
[2025-12-02 18:24:12] testing.INFO: Payment failed - stock restored {"order_id":4,"product_id":1,"quantity_restored":1,"order_cancelled":true,"stock_restored":true} 
[2025-12-02 18:24:12] testing.INFO: Order creation started {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6"} 
[2025-12-02 18:24:12] testing.INFO: Validating hold {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","attempt":1} 
[2025-12-02 18:24:12] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:12.305481Z","expires_at":"2025-12-02T18:26:12.305607Z","expires_at_timestamp":"1764699972","hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","status":"active","version":"10"}} 
[2025-12-02 18:24:12] testing.INFO: Hold validated successfully {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:12] testing.INFO: Hold validation successful {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","product_id":1,"quantity":1} 
[2025-12-02 18:24:12] testing.INFO: Creating order in database {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6"} 
[2025-12-02 18:24:12] testing.INFO: Order saved to database {"order_id":5,"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6"} 
[2025-12-02 18:24:12] testing.INFO: Order created successfully {"order_id":5,"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","product_id":1,"quantity":1} 
[2025-12-02 18:24:12] testing.INFO: Payment webhook received {"idempotency_key":"integrity_sMy2CAtl3C","order_id":5,"status":"success"} 
[2025-12-02 18:24:12] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"2bc04b85-d666-4c2b-bd9f-009d747194b6","order_id":5,"product_id":1,"quantity":1} 
[2025-12-02 18:24:12] testing.INFO: Payment succeeded {"order_id":5,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:24:12] testing.INFO: Data integrity test passed {"operations":15,"database_stock":47,"redis_stock":"47","total_orders":5} 
[2025-12-02 18:24:15] testing.INFO: Cleared all test data  
[2025-12-02 18:24:18] testing.INFO: Cleared all test data  
[2025-12-02 18:24:18] testing.INFO: Test product seeded {"product_id":1,"stock":100} 
[2025-12-02 18:24:19] testing.INFO: === Starting Redis transaction consistency test ===  
[2025-12-02 18:24:19] testing.INFO: Order creation started {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403"} 
[2025-12-02 18:24:19] testing.INFO: Validating hold {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","attempt":1} 
[2025-12-02 18:24:19] testing.DEBUG: Hold data retrieved from Redis {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","hold_data":{"product_id":"1","qty":"1","created_at":"2025-12-02T18:24:19.029255Z","expires_at":"2025-12-02T18:26:19.029381Z","expires_at_timestamp":"1764699979","hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","status":"active","version":"2"}} 
[2025-12-02 18:24:19] testing.INFO: Hold validated successfully {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","product_id":1,"quantity":1,"status":"active"} 
[2025-12-02 18:24:19] testing.INFO: Hold validation successful {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","product_id":1,"quantity":1} 
[2025-12-02 18:24:19] testing.INFO: Creating order in database {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403"} 
[2025-12-02 18:24:19] testing.INFO: Order saved to database {"order_id":1,"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403"} 
[2025-12-02 18:24:19] testing.INFO: Order created successfully {"order_id":1,"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","product_id":1,"quantity":1} 
[2025-12-02 18:24:19] testing.INFO: Payment webhook received {"idempotency_key":"consistency_test_1ieajNX5Rz","order_id":1,"status":"success"} 
[2025-12-02 18:24:19] testing.DEBUG: Payment success processed in Redis - hold deleted {"hold_id":"bd33a37b-4d37-407b-ab75-c950d2edf403","order_id":1,"product_id":1,"quantity":1} 
[2025-12-02 18:24:19] testing.INFO: Payment succeeded {"order_id":1,"product_id":1,"quantity":1,"mysql_stock_updated":true,"redis_hold_updated":true} 
[2025-12-02 18:24:19] testing.INFO: Redis transaction consistency test passed {"order_id":1} 
[2025-12-02 18:24:24] testing.INFO: Cleared all test data  
